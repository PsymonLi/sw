---
version: 2.0
builds:
  build-iris-x86:
    commands: ["sh", "-c", "cd /usr/src/github.com/pensando/sw; make checks && cd nic && V=1 make PIPELINE=iris package && find ./build -name '*.o'  | xargs rm && tar -zvcf /sw/build_iris_x86_capri.tar.gz /usr/src/github.com/pensando/sw/nic/build && cd .. && ./tools/scripts/check-local-files.sh"]
    owners: ["email:jainvipin@pensando.io"]
    artifacts:
      - /sw/build_iris_x86_capri.tar.gz
  build-iris-x86-elba:
    commands: ["sh", "-c", "cd /usr/src/github.com/pensando/sw/nic && V=1 make PIPELINE=iris ASIC=elba package &&
        find ./build -name '*.o'  | xargs rm && tar -zvcf /sw/build_iris_x86_elba.tar.gz /usr/src/github.com/pensando/sw/nic/build"]
    owners: ["email:rahulshekhar@pensando.io"]
    artifacts:
      - /sw/build_iris_x86_elba.tar.gz
  build-iris-x86-sim:
    commands: ["sh", "-c", "cd /usr/src/github.com/pensando/sw/nic && IGNORE_BUILD_PIPELINE=1 make PIPELINE=iris jobd/e2e/naples-sim-image && tar -zvcf /sw/build_iris_sim.tar.gz /usr/src/github.com/pensando/sw/nic/obj/images"]
    owners: ["email:jainvipin@pensando.io"]
    artifacts:
      - /sw/build_iris_sim.tar.gz
  build-iris-arm:
    commands: ["sh", "-c", "cd /usr/src/github.com/pensando/sw && ls -al && V=1 make CUSTOM_BUILDROOT=1 naples-firmware && ./tools/scripts/check-local-files.sh && make PIPELINE=iris naples-firmware-tarball-iris &&  ./tools/scripts/check-local-files.sh"]
    owners: ["email:jainvipin@pensando.io"]
    artifacts:
      - /sw/naples_fw_all.tgz
  build-iris-arm-elba:
    commands: ["sh", "-c", "cd /usr/src/github.com/pensando/sw && ls -al && V=1 ASIC=elba make CUSTOM_BUILDROOT=1 naples-firmware && ASIC=elba make PIPELINE=iris naples-firmware-tarball-iris"]
    owners: ["email:rahulshekhar@pensando.io"]
    artifacts:
      - /sw/naples_fw_all_elba.tgz
  build-iota:
    commands: ["sh", "-c", "cd /usr/src/github.com/pensando/sw && ls -al && cd iota && make iota-tarball"]
    owners: ["email:jainvipin@pensando.io"]
    artifacts:
      - /sw/iota.tgz
  build-gft-x86:
    commands: ["sh", "-c", "cd /usr/src/github.com/pensando/sw/nic && make PIPELINE=gft package && find ./build -name '*.o'  | xargs rm && tar -zvcf /sw/build_gft_x86.tar.gz /usr/src/github.com/pensando/sw/nic/build"]
    owners: ["email:jainvipin@pensando.io"]
    artifacts:
      - /sw/build_gft_x86.tar.gz
  build-apulu-x86:
    # build-apulu-valgrind also builds apulu binaries. Update it incase this cmd changes
    commands: ["sh", "-c", "cd /usr/src/github.com/pensando/sw/nic && make PIPELINE=apulu package && find ./build -name '*.o'  | xargs rm && tar -zvcf /sw/build_apulu_x86.tar.gz /usr/src/github.com/pensando/sw/nic/build /usr/src/github.com/pensando/sw/nic/third-party/metaswitch/output/x86_64/lib*"]
    owners: ["email:jainvipin@pensando.io"]
    artifacts:
      - /sw/build_apulu_x86.tar.gz
  build-apulu-x86-sim:
    commands: ["sh", "-c", "cd /usr/src/github.com/pensando/sw/nic && IGNORE_BUILD_PIPELINE=1 make PIPELINE=apulu FLAVOR=-venice jobd/e2e/naples-sim-image && cd .. && tar -zvcf /sw/build_apulu_sim.tar.gz nic/obj/images"]
    owners: ["email:jainvipin@pensando.io"]
    artifacts:
      - /sw/build_apulu_sim.tar.gz
  build-apulu-arm:
    commands: ["sh", "-c", "cd /usr/src/github.com/pensando/sw && ls -al && make PIPELINE=apulu CUSTOM_BUILDROOT=1 naples-firmware && make PIPELINE=apulu naples-firmware-tarball-apulu && make PIPELINE=apulu naples-protos-apulu"]
    owners: ["email:jainvipin@pensando.io"]
    artifacts:
      - /sw/naples_fw_all_apulu.tgz
      - /sw/naples-protos-apulu.tgz
  # build-custom-athena-image:
  #   commands: ["sh", "-c", "cd /usr/src/github.com/pensando/sw/nic && make PIPELINE=athena && make PIPELINE=athena ARCH=aarch64 PLATFORM=hw && make PIPELINE=athena ARCH=aarch64 PLATFORM=hw CUSTOM_BUILDROOT=1 firmware && pwd && ./apollo/tools/dev-docker/build_dev_docker.sh 1 all athena 1"]
  #   owners: ["email:murali@pensando.io"]
  #   artifacts:
  #     - /sw/customimage.tar.gz
  build-athena-arm-native-sim:
    commands: ["sh", "-c", "cd /usr/src/github.com/pensando/sw/nic/athena/apps/athena_app && mkdir -p /tmp/athena &&
        ./gsrc.py --src /usr/src/github.com/pensando --dst /tmp/athena/src/github.com/pensando &&
        tar zcf /sw/pen-src-sim.tar.gz -C /tmp/athena src && ./build_athena /tmp/athena s &&
        cp /tmp/athena/src/github.com/pensando/sw/nic/nic.tar /sw/athena-sim-nic.tar &&
        cp /tmp/athena/src/github.com/pensando/sw/nic/build/aarch64/athena/capri/out/athena_app_bin/athena_app.bin /sw/athena_app-sim.bin"]
    owners: ["email:jason@pensando.io"]
    artifacts:
      - /sw/pen-src-sim.tar.gz
      - /sw/athena-sim-nic.tar
      - /sw/athena_app-sim.bin
  build-athena-arm-native:
    commands: ["sh", "-c", "cd /usr/src/github.com/pensando/sw && asset-pull athena_nb 0.0.2 /dev/stdout | tar xz &&
        cd /usr/src/github.com/pensando/sw/nic/athena/apps/athena_app && mkdir -p /tmp/athena &&
        ./gsrc.py --src /usr/src/github.com/pensando --dst /tmp/athena/src/github.com/pensando && ./arm-job"]
    owners: ["email:jason@pensando.io"]
    artifacts:
      - /sw/pen-src.tar.gz
      - /sw/athena_app.bin
      - /sw/athena-nic.tar
      - /sw/athena-build-log
  build-athena-customer-arm:
    commands: ["sh", "-c", "cd /usr/src/github.com/pensando/sw/nic && ./athena/apps/athena_app/bld_pkg_athena --arch=aarch64 --output=athena-arm"]
    owners: ["email:murali@pensando.io"]
    artifacts:
      - /sw/athena-arm.tar.gz
  build-athena-customer-x86:
    commands: ["sh", "-c", "cd /usr/src/github.com/pensando/sw/nic && ./athena/apps/athena_app/bld_pkg_athena --arch=x86_64 --output=athena-x86"]
    owners: ["email:murali@pensando.io"]
    artifacts:
      - /sw/athena-x86.tar.gz
  build-athena-x86:
    commands: ["sh", "-c", "cd /usr/src/github.com/pensando/sw/nic && make PIPELINE=athena package && find ./build -name '*.o'  | xargs rm && tar -zvcf /sw/build_athena_x86.tar.gz /usr/src/github.com/pensando/sw/nic/build"]
    owners: ["email:skittur@pensando.io"]
    artifacts:
      - /sw/build_athena_x86.tar.gz
  build-athena14-x86:
    commands: ["sh", "-c", "cd /usr/src/github.com/pensando/sw/nic && make P4VER=P4_14 PIPELINE=athena package && find ./build -name '*.o'  | xargs rm && tar -zvcf /sw/build_athena14_x86.tar.gz /usr/src/github.com/pensando/sw/nic/build"]
    owners: ["email:skittur@pensando.io"]
    artifacts:
      - /sw/build_athena14_x86.tar.gz
  build-athena-arm:
    commands: ["sh", "-c", "cd /usr/src/github.com/pensando/sw && ls -al && make PIPELINE=athena CUSTOM_BUILDROOT=1 naples-firmware && make PIPELINE=athena naples-firmware-tarball-athena"]
    owners: ["email:skittur@pensando.io"]
    artifacts:
      - /sw/naples_fw_all_athena.tgz
  #build-athena-arm-mfg:
  #  commands: ["sh", "-c", "cd /usr/src/github.com/pensando/sw && ls -al && make PIPELINE=athena CUSTOM_BUILDROOT=1 PKG_ARGS=\"--kvp MFG-DIR=mfg\" naples-firmware && make PIPELINE=athena naples-firmware-tarball-athena-mfg"]
  #  owners: ["email:vignesh@pensando.io"]
  #  artifacts:
  #    - /sw/naples_fw_all_athena_mfg.tgz
  build-venice-image:
    commands: ["bash", "-c", "mkdir -p /sw/bin; cd /usr/src/github.com/pensando/sw/test/ci_targets/e2e-venice-image; GIT_VERSION=$(git describe --tags --dirty --always) GIT_COMMIT=$(git rev-list -1 HEAD --abbrev-commit) go run make-venice-image.go; sync; ls -al /sw/bin"]
    owners: ["email:jainvipin@pensando.io"]
    artifacts:
      - /sw/bin/venice.tgz
      - /sw/bin/venice_apidoc.pdf
    repo_dir: "/import/src/github.com/pensando/sw"
    create:
      image: build-150
      count: 1
      resources:
        cpus: 16
        memory: 32
    provision:
      username: vm
      password: vm
      # additional vars to pass to ansible.
      vars:
  build-venice-apulu-image:
    commands: ["bash", "-c", "cd /usr/src/github.com/pensando/sw/nic && make PIPELINE=apulu pegasus && cd .. && python ./nic/tools/package/package.py --target pegasus --pipeline apulu --no-strip && ls -al /sw/nic/ && mkdir -p /sw/bin; cd /usr/src/github.com/pensando/sw/test/ci_targets/e2e-venice-apulu-image; GIT_VERSION=$(git describe --tags --dirty --always) GIT_COMMIT=$(git rev-list -1 HEAD --abbrev-commit) go run make-venice-apulu-image.go"]
    owners: ["email:jainvipin@pensando.io"]
    artifacts:
      - /sw/bin/venice.apulu.tgz
    repo_dir: "/import/src/github.com/pensando/sw"
    create:
      image: build-150
      count: 1
      resources:
        cpus: 16
        memory: 32
    provision:
      username: vm
      password: vm
      # additional vars to pass to ansible.
      vars:
  build-venice-upgrade-image:
    commands: ["bash", "-c", "mkdir -p /sw/bin/venice-install; cd /usr/src/github.com/pensando/sw/test/ci_targets/e2e-venice-upgrade-image; GIT_UPGRADE_VERSION=iota-upgrade GIT_COMMIT=$(git rev-list -1 HEAD --abbrev-commit) go run make-venice-upgrade-image.go"]
    owners: ["email:jainvipin@pensando.io"]
    artifacts:
      - /sw/bin/venice.upg.tgz
      - /sw/bin/venice-install/venice_appl_os.tgz
    repo_dir: "/import/src/github.com/pensando/sw"
    create:
      image: build-150
      count: 1
      resources:
        cpus: 16
        memory: 32
    provision:
      username: vm
      password: vm
      # additional vars to pass to ansible.
      vars:
  build-apulu-x86-controlplane-dol:
    # Package nic build directory, libraries from sdk, hal, buildroot,
    # metaswitch and all the dol files at the runner
    commands: ["sh", "-c", "cd /usr/src/github.com/pensando/sw/nic && make PIPELINE=apulu && cd .. && make controlplane-dol-pkg"]
    owners: ["email:mukesh@pensando.io","email:vijasrin@pensando.io"]
    artifacts:
      - /sw/build_apulu_x86_ctpl_dol.tar.gz

  # apulu valgrind tests take ~30G memory
  # build VM have ~32G and regular VMs have ~20G
  # moving the test to sw/.job.yml to run this in buld VM
  build-apulu-valgrind:
    # TODO remove building apulu binaries once multi-level build dependency is supported
    commands: ["sh", "-c", "cd /usr/src/github.com/pensando/sw/nic && make PIPELINE=apulu package && make PIPELINE=apulu jobd/apulu/gtests-valgrind && touch /tmp/apulu_gtests_valgrind.done"]
    owners: ["email:sai@pensando.io"]
    artifacts:
      - /tmp/apulu_gtests_valgrind.done

targets:
  submodules:
    commands: ["sh", "-c", "TOP=/sw ./scripts/check-submodules.sh"]
    owners: ["email:stavros@pensando.io"]
    area:
    sub-area:
    feature:
  yaml-checker:
    commands: ["sh", "-c", "./scripts/check-yaml.py iota"]
    owners: ["email:salvoc@pensando.io"]
    area:
    sub-area:
    feature:

image:
  bind_dir: "/sw"
  work_dir: "/sw"
queue_name: builder
jobs:
  api:
    labels: ["CI-Sanity-Build"]
  asset-build:
    labels: ["CI-Sanity-Build"]
  docs:
    labels: ["CI-Sanity-Build"]
  dol:
    labels: ["CI-Sim-UnitTest-Ent", "CI-Sim-UnitTest-Cloud"]
  iota:
    labels: ["CI-Sanity-Build"]
  iota/test/venice:
    labels: ["CI-Sanity-Build"]
  iota/test/venice/vcenter:
    labels: ["CI-Regression"]
  iota/test/standalone/precheckin/esx:
    labels: ["CI-Precheckin-ESX"]
  iota/test/standalone/precheckin/linux:
    labels: ["CI-Precheckin-Linux"]
  iota/test/standalone/precheckin/windows:
    labels: ["CI-Precheckin-Windows"]
  iota/test/standalone/precheckin/freebsd:
    labels: ["CI-Precheckin-Freebsd"]
  iota/test/standalone/precheckin/linux-rdma:
    labels: ["CI-Precheckin-LinuxRDMA"]
  iota/test/standalone/precheckin/freebsd-rdma:
    labels: ["CI-Precheckin-FreebsdRDMA"]
  iota/test/standalone/sanity/freebsd:
    labels: ["CI-Sanity-Build", "CI-Santity-Freebsd"]
  iota/test/standalone/sanity/esx:
    labels: ["CI-Sanity-Build", "CI-Sanity-ESX"]
  iota/test/standalone/sanity/linux:
    labels: ["CI-Sanity-Build", "CI-Sanity-Linux"]
  iota/test/standalone/sanity/windows:
    labels: ["CI-Sanity-Build", "CI-Sanity-Windows"]
  iota/test/standalone/sanity/apulu:
    labels: ["CI-Sanity-Build", "CI-Sanity-Apulu"]
  nic/apollo/tools/apulu/sanity/base:
    labels: ["CI-Sanity-Build", "CI-Sanity-ApuluBase"]
  nic/apollo/tools/apulu/sanity/customer-docker:
    labels: ["CI-Sanity-Build", "CI-Sanity-ApuluCustDocker"]
  iota/test/standalone/precheckin/apulu-core:
    labels: ["CI-Precheckin-ApuluCore"]
  iota/test/standalone/precheckin/apulu-sdn-pds:
    labels: ["CI-Precheckin-ApuluSdnPds"]
  iota/test/standalone/precheckin/athena:
    labels: ["CI-Sanity-Build", "CI-Precheckin-Athena"]
  iota/test/standalone/regression/esx:
    labels: ["CI-Regression", "CI-Regression-ESX"]
  iota/test/standalone/regression/freebsd:
    labels: ["CI-Regression", "CI-Regression-Freebsd"]
  iota/test/standalone/regression/freebsd-rdma:
    labels: ["CI-Weekly", "CI-Regression-FreebsdRDMA"]
  iota/test/standalone/regression/linux:
    labels: ["CI-Regression", "CI-Regression-Linux"]
  iota/test/standalone/regression/linux-rdma:
    labels: ["CI-Weekly", "CI-Regression-LinuxRDMA"]
  iota/test/standalone/compat/tot:
    labels: ["CI-Regression", "CI-Compat-Regression"]
  iota/test/standalone/regression/windows:
    labels: ["CI-Regression", "CI-Regression-Windows"]
  iota/test/standalone/regression/linkmgr:
    labels: ["CI-Regression", "CI-Regression-Linkmgr"]
  iota/test/standalone/compat/compat-server/esx6_7:
    labels: ["compat-server"]
  iota/test/standalone/compat/compat-server/windows2019:
    labels: ["compat-server"]
  iota/test/standalone/compat/compat-server/rhel7u3:
    labels: ["compat-server"]
  iota/test/standalone/compat/compat-server/rhel7u5:
    labels: ["compat-server"]
  iota/test/standalone/compat/compat-server/rhel7u6:
    labels: ["compat-server"]
  iota/test/standalone/compat/compat-server/rhel7u7:
    labels: ["compat-server"]
  iota/test/standalone/compat/compat-server/rhel7u8:
    labels: ["compat-server"]
  iota/test/standalone/compat/compat-server/rhel8u0:
   labels: ["compat-server"]
  iota/test/standalone/compat/compat-server/rhel8u1:
    labels: ["compat-server"]
  iota/test/standalone/compat/compat-server/sles12sp4:
    labels: ["compat-server"]
  iota/test/standalone/compat/compat-server/sles12sp5:
    labels: ["compat-server"]
  iota/test/standalone/compat/compat-server/sles15:
    labels: ["compat-server"]
  iota/test/standalone/compat/compat-server/sles15sp1:
    labels: ["compat-server"]
  iota/test/standalone/compat/compat-server/ubuntu18043:
    labels: ["compat-server"]
  iota/test/standalone/compat/compat-server/esx6_7-reboot:
    labels: ["compat-server-reboot"]
  iota/test/standalone/compat/compat-server/esx6_5-reboot:
    labels: ["compat-server-reboot"]
  iota/test/standalone/compat/compat-server/windows2019-reboot:
    labels: ["compat-server-reboot"]
  iota/test/standalone/compat/compat-server/rhel7u3-reboot:
    labels: ["compat-server-reboot"]
  iota/test/standalone/compat/compat-server/rhel7u5-reboot:
    labels: ["compat-server-reboot"]
  iota/test/standalone/compat/compat-server/rhel7u6-reboot:
    labels: ["compat-server-reboot"]
  iota/test/standalone/compat/compat-server/rhel7u7-reboot:
    labels: ["compat-server-reboot"]
  iota/test/standalone/compat/compat-server/rhel7u8-reboot:
    labels: ["compat-server-reboot"]
  iota/test/standalone/compat/compat-server/rhel8u0-reboot:
   labels: ["compat-server-reboot"]
  iota/test/standalone/compat/compat-server/rhel8u1-reboot:
    labels: ["compat-server-reboot"]
  iota/test/standalone/compat/compat-server/sles12sp4-reboot:
    labels: ["compat-server-reboot"]
  iota/test/standalone/compat/compat-server/sles12sp5-reboot:
    labels: ["compat-server-reboot"]
  iota/test/standalone/compat/compat-server/sles15-reboot:
    labels: ["compat-server-reboot"]
  iota/test/standalone/compat/compat-server/sles15sp1-reboot:
    labels: ["compat-server-reboot"]
  iota/test/standalone/compat/compat-server/ubuntu18043-reboot:
    labels: ["compat-server-reboot"]
  iota/test/standalone/compat/compat-server/esx6_5-reboot-uefi:
    labels: ["compat-other-reboot-uefi"]
  iota/test/standalone/compat/compat-server/windows2019-reboot-uefi:
    labels: ["compat-other-reboot-uefi"]
  iota/test/standalone/compat/compat-server/rhel7u5-reboot-uefi:
    labels: ["compat-rhel-reboot-uefi"]
  iota/test/standalone/compat/compat-server/rhel7u6-reboot-uefi:
    labels: ["compat-rhel-reboot-uefi"]
  iota/test/standalone/compat/compat-server/rhel7u7-reboot-uefi:
    labels: ["compat-rhel-reboot-uefi"]
  iota/test/standalone/compat/compat-server/rhel7u8-reboot-uefi:
    labels: ["compat-rhel-reboot-uefi"]
  iota/test/standalone/compat/compat-server/rhel7u9-reboot-uefi:
    labels: ["compat-rhel-reboot-uefi"]
  iota/test/standalone/compat/compat-server/rhel8-reboot-uefi:
    labels: ["compat-rhel-reboot-uefi"]
  iota/test/standalone/compat/compat-server/rhel8u1-reboot-uefi:
    labels: ["compat-rhel-reboot-uefi"]
  iota/test/standalone/compat/compat-server/rhel8u2-reboot-uefi:
    labels: ["compat-rhel-reboot-uefi"]
  iota/test/standalone/compat/compat-server/rhel8u3-reboot-uefi:
    labels: ["compat-rhel-reboot-uefi"]
  iota/test/standalone/compat/compat-server/sles12sp4-reboot-uefi:
    labels: ["compat-sles-reboot-uefi"]
  iota/test/standalone/compat/compat-server/sles12sp5-reboot-uefi:
    labels: ["compat-sles-reboot-uefi"]
  iota/test/standalone/compat/compat-server/sles15-reboot-uefi/:
    labels: ["compat-sles-reboot-uefi"]
  iota/test/standalone/compat/compat-server/sles15sp1-reboot-uefi/:
    labels: ["compat-sles-reboot-uefi"]
#  iota/test/standalone/compat/compat-server/sles15sp2-reboot-uefi/:
#    labels: ["compat-sles-reboot-uefi"]
  iota/test/standalone/compat/compat-server/ubuntu18043-reboot-uefi/:
    labels: ["compat-other-reboot-uefi"]
  iota/test/standalone/compat/compat-server/ubuntu2004-reboot-uefi/:
    labels: ["compat-other-reboot-uefi"]
  iota/test/standalone/rpm:
    label: ["CI-Weekly"]
  iota/test/standalone/os_coverage/linux:
    label: ["CI-Weekly"]
  iota/test/standalone/os_coverage_apulu/linux:
    label: ["CI-Weekly"]
  iota/test/standalone/cnic_swm:
    labels: ["CI-Sanity-Build", "CI-Sanity-CnicSWM"]
  iota/test/standalone/sanity/swm:
    labels: ["CI-Sanity-Build", "CI-Sanity-SWM"]
  iota/test/standalone/regression/swm:
    labels: ["CI-Regression", "CI-Regression-SWM"]
  iota/test/standalone/dualnic/linux:
    labels: ["CI-DualNIC", "CI-DualNIC-Linux"]
  iota/test/standalone/dualnic/windows:
    labels: ["CI-DualNIC", "CI-DualNIC-Windows"]
  iota/test/standalone/dualnic/esx:
    labels: ["CI-DualNIC", "CI-DualNIC-ESX"]
  iota/test/venice/regression:
    labels: ["CI-Regression", "CI-Regression-Venice"]
  iota/test/venice/sim:
    labels: ["CI-Sim-UnitTest-Ent"]
  nic:
    labels: ["CI-Sim-UnitTest-Ent", "CI-Sim-UnitTest-Cloud", "CI-Sanity-Build"]
  nic/agent:
    labels: ["CI-Sim-UnitTest-Ent", "CI-Sim-UnitTest-Cloud"]
  nic/athena/tools/sanity/base:
    labels: ["CI-Sanity-Build", "CI-Precheckin-Athena", "CI-Sim-UnitTest-Cloud"]
  # nic/apollo/tools/athena/sanity/customer-docker:
    # labels: [ "CI-Sim-UnitTest-Cloud"]
  nic/infra/operd/tests/tools/sanity/base:
    labels: ["CI-Sim-UnitTest-Ent", "CI-Sim-UnitTest-Cloud"]
  nic/infra/operd/tests/tools/sanity/apulu:
    labels: ["CI-Sim-UnitTest-Cloud"]
  nic/sdk:
    labels: ["CI-Sim-UnitTest-Ent", "CI-Sim-UnitTest-Cloud"]
  penctl:
    labels: ["CI-Sim-UnitTest-Ent", "CI-Sim-UnitTest-Cloud"]
  platform:
    labels: ["CI-Sim-UnitTest-Ent", "CI-Sim-UnitTest-Cloud"]
  platform/drivers/linux:
    labels: ["CI-Sanity-Build"]
  platform/penutil:
    labels: ["CI-Sanity-Build"]
  platform/src/app/pciemgrd:
    labels: ["CI-Sim-UnitTest-Ent", "CI-Sim-UnitTest-Cloud"]
  storage/offload:
    labels: ["CI-Sim-UnitTest-Ent", "CI-Sim-UnitTest-Cloud"]
  storage/offload/linux-build-test:
    labels: ["CI-Sim-UnitTest-Ent", "CI-Sim-UnitTest-Cloud"]
  test/ci_targets/e2e:
    labels: ["CI-Sanity-Build"]
  test/ci_targets/e2erollout:
    labels: ["CI-Sanity-Build"]
  test/ci_targets/cloud-e2e:
    labels: ["CI-Sanity-Build"]
  # this is one dummy job only for verify some folder change not impact iris build
  # no label is required
  test/verify-build:
  venice:
    labels: ["CI-Sim-UnitTest-Ent"]
  venice/ui:
    labels: ["CI-Sim-UnitTest-Ent"]
  test/ci_targets/controlplane-dol:
    labels: ["CI-Sim-UnitTest-Cloud"]

dependencies:
  api:
    - reference: test/ci_targets/e2e
    - reference: test/ci_targets/cloud-e2e
    - reference: venice/ui
    - reference: iota/test/venice
  dol/apollo:
    - reference: iota/test/standalone/precheckin/apulu-sdn-pds
    - reference: nic/infra/operd/tests/tools/sanity/apulu
    - reference: nic/apollo/tools/apulu/sanity/base
    - reference: test/ci_targets/controlplane-dol
  dol/apulu:
    - reference: nic/infra/operd/tests/tools/sanity/apulu
    - reference: nic/apollo/tools/apulu/sanity/base
    - reference: test/ci_targets/controlplane-dol
  dol/test/networking:
    - reference: nic
  events:
    - reference: api
    - reference: test/ci_targets/e2e
    - reference: test/ci_targets/cloud-e2e
    - reference: iota/test/venice
    - reference: venice/ui
  iota/harness:
    - reference: iota/test/standalone/precheckin/esx
    - reference: iota/test/standalone/precheckin/linux
    - reference: iota/test/standalone/precheckin/windows
    - reference: iota/test/standalone/precheckin/athena
    - reference: iota/test/standalone/precheckin/apulu-sdn-pds
    - reference: iota/test/standalone/sanity/swm
  iota/scripts:
    - reference: iota/test/standalone/precheckin/esx
    - reference: iota/test/standalone/precheckin/linux
    - reference: iota/test/standalone/precheckin/windows
    - reference: iota/test/standalone/precheckin/athena
    - reference: iota/test/standalone/precheckin/apulu-sdn-pds
    - reference: iota/test/venice
    - reference: iota/test/venice/vcenter
    - reference: iota/test/standalone/sanity/swm
  iota/svcs:
    - reference: iota/test/standalone/precheckin/esx
    - reference: iota/test/standalone/precheckin/linux
    - reference: iota/test/standalone/precheckin/windows
    - reference: iota/test/standalone/precheckin/apulu-sdn-pds
    - reference: iota/test/standalone/precheckin/athena
    - reference: iota/test/venice
    - reference: iota/test/venice/vcenter
  iota/test/apulu:
    - reference: iota/test/standalone/precheckin/apulu-sdn-pds
  iota/test/athena:
    - reference: iota/test/standalone/precheckin/athena
  iota/test/iris:
    - reference: iota/test/standalone/precheckin/esx
      exclude_dirs: ["testcases/server","testcases/rdma","testbundles/rdma","testcases/qos"]
    - reference: iota/test/standalone/precheckin/linux
      exclude_dirs: ["testcases/server","testcases/rdma","testbundles/rdma","testcases/qos"]
    - reference: iota/test/standalone/precheckin/windows
      exclude_dirs: ["testcases/server","testcases/rdma","testbundles/rdma","testcases/qos"]
  iota/test/standalone:
    - reference: iota/test/standalone/precheckin/esx
      exclude_dirs: ["regression","precheckin"]
    - reference: iota/test/standalone/precheckin/linux
      exclude_dirs: ["regression","precheckin"]
  iota/test/standalone/precheckin/esx:
    - reference: iota/test/standalone/precheckin/esx
  iota/test/standalone/precheckin/freebsd:
    - reference: iota/test/standalone/precheckin/freebsd
  iota/test/standalone/precheckin/freebsd-rdma:
    - reference: iota/test/standalone/precheckin/freebsd-rdma
  iota/test/standalone/precheckin/linux:
    - reference: iota/test/standalone/precheckin/linux
  iota/test/standalone/precheckin/linux-rdma:
    - reference: iota/test/standalone/precheckin/linux-rdma
  iota/test/standalone/precheckin/windows:
    - reference: iota/test/standalone/precheckin/windows
  iota/test/standalone/sanity/windows:
    - reference: iota/test/standalone/sanity/windows
  iota/test/standalone/sanity/freebsd:
    - reference: iota/test/standalone/sanity/freebsd
  iota/test/standalone/sanity/linux:
    - reference: iota/test/standalone/sanity/linux
  iota/test/utils:
    - reference: iota/test/standalone/precheckin/esx
    - reference: iota/test/standalone/precheckin/linux
  iota/test/iris/testcases/swm:
    - reference: iota/test/standalone/sanity/swm
  iota/test/iris/testcases/qos:
    - reference: iota/test/standalone/precheckin/freebsd-rdma
    - reference: iota/test/standalone/precheckin/linux-rdma
  iota/test/iris/testcases/rdma:
    - reference: iota/test/standalone/precheckin/freebsd-rdma
    - reference: iota/test/standalone/precheckin/linux-rdma
  iota/test/iris/testbundles/rdma:
    - reference: iota/test/standalone/precheckin/freebsd-rdma
    - reference: iota/test/standalone/precheckin/linux-rdma
  metrics:
    - reference: api
    - reference: test/ci_targets/e2e
    - reference: test/ci_targets/cloud-e2e
    - reference: iota/test/venice
    - reference: venice/ui
  minio:
    - reference: test/verify-build
    - reference: iota/test/standalone/precheckin/linux
  nic/apollo:
    - reference: nic/infra/operd/tests/tools/sanity/apulu
    - reference: iota/test/venice
      exclude_dirs: ["p4/athena_p4-16", "test/athena_app", "test/athena", "api/impl/athena", "api/include/athena"]
    - reference: iota/test/standalone/precheckin/apulu-sdn-pds
      exclude_dirs: ["p4/athena_p4-16", "test/athena_app", "test/athena", "api/impl/athena", "api/include/athena"]
    - reference: nic/apollo/tools/apulu/sanity/base
      exclude_dirs: ["p4/athena_p4-16", "test/athena_app", "test/athena", "api/impl/athena", "api/include/athena"]
    - reference: nic/athena/tools/sanity/base
    - reference: iota/test/standalone/precheckin/athena
    - reference: test/ci_targets/cloud-e2e
      exclude_dirs: ["p4/athena_p4-16", "test/athena_app", "test/athena", "api/impl/athena", "api/include/athena"]
    - reference: test/ci_targets/controlplane-dol
      exclude_dirs: ["p4/athena_p4-16", "test/athena_app", "test/athena", "api/impl/athena", "api/include/athena"]
  nic/apollo/tools/dev-docker:
    - reference: nic/apollo/tools/apulu/sanity/customer-docker
    # - reference: nic/apollo/tools/athena/sanity/customer-docker
  nic/apollo/p4/athena_p4-16:
    - reference: iota/test/standalone/precheckin/athena
  nic/athena:
    - reference: iota/test/standalone/precheckin/athena
  nic/agent:
    - reference: iota/test/venice
    - reference: iota/test/standalone/precheckin/esx
    - reference: iota/test/standalone/precheckin/linux
    - reference: api
    - reference: test/ci_targets/e2e
    - reference: test/ci_targets/cloud-e2e
  nic/agent/nmd:
    - reference: nic/apollo/tools/apulu/sanity/base
      exclude_dirs: ["pipeline/iris"]
    - reference: iota/test/venice
    - reference: iota/test/standalone/precheckin/esx
    - reference: iota/test/standalone/precheckin/linux
    - reference: api
    - reference: test/ci_targets/e2e
    - reference: test/ci_targets/cloud-e2e
  nic/asm:
    - reference: iota/test/venice
      exclude_dirs: ["rdma"]
    - reference: iota/test/standalone/precheckin/esx
      exclude_dirs: ["rdma"]
    - reference: iota/test/standalone/precheckin/linux
      exclude_dirs: ["rdma"]
  nic/buildroot:
    - reference: iota/test/venice
    - reference: iota/test/standalone/precheckin/esx
    - reference: iota/test/standalone/precheckin/linux
    - reference: iota/test/standalone/precheckin/apulu-sdn-pds
  nic/conf:
    - reference: iota/test/standalone/precheckin/linux
  nic/conf/apulu:
    - reference: iota/test/standalone/precheckin/apulu-sdn-pds
    - reference: nic/apollo/tools/apulu/sanity/base
    - reference: test/ci_targets/controlplane-dol
  nic/debug_cli:
    - reference: iota/test/standalone/precheckin/linux
  nic/delphi:
    - reference: iota/test/standalone/precheckin/linux
  nic/fte:
    - reference: iota/test/standalone/precheckin/linux
    - reference: iota/test/standalone/precheckin/esx
  nic/hal:
    - reference: iota/test/venice
    - reference: iota/test/standalone/precheckin/esx
    - reference: iota/test/standalone/precheckin/linux
    - reference: iota/test/standalone/sanity/swm
  nic/include:
    - reference: iota/test/venice
    - reference: iota/test/standalone/precheckin/esx
    - reference: iota/test/standalone/precheckin/linux
  nic/linkmgr:
    - reference: iota/test/venice
    - reference: iota/test/standalone/precheckin/esx
    - reference: iota/test/standalone/precheckin/linux
  nic/metaswitch:
    - reference: iota/test/standalone/precheckin/apulu-sdn-pds
    - reference: nic/apollo/tools/apulu/sanity/base
    - reference: test/ci_targets/cloud-e2e
    - reference: test/ci_targets/controlplane-dol
  nic/infra/operd:
    - reference: nic/infra/operd/tests/tools/sanity/base
    - reference: nic/infra/operd/tests/tools/sanity/apulu
    - reference: iota/test/venice
    - reference: iota/test/standalone/precheckin/apulu-sdn-pds
  nic/p4-hlir:
    - reference: iota/test/venice
    - reference: iota/test/standalone/precheckin/esx
    - reference: iota/test/standalone/precheckin/linux
  nic/p4:
    - reference: iota/test/venice
      exclude_dirs: ["rdma"]
    - reference: iota/test/standalone/precheckin/esx
      exclude_dirs: ["rdma"]
    - reference: iota/test/standalone/precheckin/linux
      exclude_dirs: ["rdma"]
  nic/asm/rdma:
    - reference: iota/test/standalone/precheckin/linux-rdma
    - reference: iota/test/standalone/precheckin/freebsd-rdma
  nic/proto:
    - reference: api
    - reference: venice/ui
    - reference: iota/test/standalone/precheckin/esx
  nic/sdk:
    - reference: iota/test/standalone/precheckin/esx
    - reference: iota/test/standalone/precheckin/linux
    - reference: iota/test/standalone/precheckin/apulu-sdn-pds
    - reference: nic/apollo/tools/apulu/sanity/base
    - reference: nic/athena/tools/sanity/base
    - reference: test/ci_targets/controlplane-dol
  nic/sysmgr:
    - reference: iota/test/venice
    - reference: iota/test/standalone/precheckin/linux
    - reference: iota/test/standalone/precheckin/esx    # for testing upgrade support in sysmgr
    - reference: iota/test/standalone/precheckin/apulu-sdn-pds
    - reference: nic/apollo/tools/apulu/sanity/base
  nic/third-party:
    - reference: iota/test/venice
    - reference: iota/test/standalone/precheckin/esx
    - reference: iota/test/standalone/precheckin/linux
      exclude_dirs: ["metaswitch"]
  nic/third-party/metaswitch:
    - reference: iota/test/standalone/precheckin/apulu-sdn-pds
    - reference: nic/apollo/tools/apulu/sanity/base
    - reference: test/ci_targets/cloud-e2e
    - reference: test/ci_targets/controlplane-dol
  nic/tools:
    - reference: iota/test/standalone/precheckin/esx
    - reference: iota/test/standalone/precheckin/linux
    - reference: iota/test/standalone/precheckin/apulu-sdn-pds
    - reference: iota/test/venice
      exclude_dirs: ["arm_compiler","asic_sw_combined_sanity","client","gcov","hal","jenkins","ncc","package","server", "valgrind"]
  nic/tools/ncc:
    - reference: nic/apollo/tools/apulu/sanity/base
    - reference: nic/athena/tools/sanity/base
  nic/tools/package:
    - reference: nic/apollo/tools/apulu/sanity/customer-docker
  nic/upgrade_manager:
    - reference: iota/test/standalone/precheckin/esx
  nic/utils:
    - reference: iota/test/standalone/precheckin/linux
  nic/utils/ftl:
    - reference: iota/test/standalone/precheckin/esx
  nic/vpp:
    - reference: iota/test/standalone/precheckin/apulu-sdn-pds
    - reference: nic/apollo/tools/apulu/sanity/base
  nic/conf/athena:
    - reference: nic/athena/tools/sanity/base
  nic/debug_cli/apollo:
    - reference: nic/apollo/tools/apulu/sanity/base
  nic/sdk/platform/cfgspace:
    - reference: platform/src/app/pciemgrd
  nic/sdk/platform/intrutils:
    - reference: platform/src/app/pciemgrd
  nic/sdk/platform/pciehdevices:
    - reference: platform/src/app/pciemgrd
  nic/sdk/platform/pciemgr:
    - reference: platform/src/app/pciemgrd
  nic/sdk/platform/pciemgrd:
    - reference: platform/src/app/pciemgrd
  nic/sdk/platform/pciemgrutils:
    - reference: platform/src/app/pciemgrd
  nic/sdk/platform/pcieport:
    - reference: platform/src/app/pciemgrd
  nic/sdk/platform/pcietlp:
    - reference: platform/src/app/pciemgrd
  nic/sdk/platform/ncsi:
    - reference: iota/test/standalone/sanity/swm
  nic/agent/dscagent/pipeline:
    - reference: nic/apollo/tools/apulu/sanity/base
      exclude_dirs: ["iris"]
  platform/drivers/esxi:
    - reference: iota/test/standalone/precheckin/esx
  platform/drivers/windows:
    - reference: iota/test/standalone/precheckin/windows
  platform/drivers/freebsd:
    - reference: iota/test/standalone/precheckin/freebsd-rdma
  platform/drivers/linux:
    - reference: iota/test/standalone/precheckin/linux-rdma
    - reference: iota/test/standalone/precheckin/esx
      exclude_dirs: ["rdma"]
    - reference: iota/test/standalone/precheckin/apulu-core
      exclude_dirs: ["rdma"]
    - reference: iota/test/standalone/precheckin/apulu-sdn-pds
      exclude_dirs: ["rdma"]
    - reference: iota/test/standalone/sanity/swm
  platform/drivers/common:
    - reference: iota/test/standalone/precheckin/linux-rdma
    - reference: iota/test/standalone/precheckin/freebsd-rdma
    - reference: iota/test/standalone/precheckin/esx
      exclude_dirs: ["rdma"]
    - reference: iota/test/standalone/precheckin/apulu-core
      exclude_dirs: ["rdma"]
    - reference: iota/test/standalone/precheckin/apulu-sdn-pds
      exclude_dirs: ["rdma"]
  platform/src/app/asicerrord:
    - reference: iota/test/standalone/precheckin/linux
  platform/src/app/captrace:
    - reference: iota/test/standalone/precheckin/linux
  platform/src/app/cpld:
    - reference: iota/test/standalone/precheckin/linux
  platform/src/app/diag:
    - reference: iota/test/standalone/precheckin/linux
  platform/src/app/fructl:
    - reference: iota/test/standalone/precheckin/linux
  platform/src/app/ncsid:
    - reference: iota/test/standalone/sanity/swm
  platform/src/app/nicmgrd:
    - reference: iota/test/venice
    - reference: iota/test/standalone/precheckin/esx
    - reference: nic/apollo/tools/apulu/sanity/base
    - reference: iota/test/standalone/precheckin/linux
    - reference: iota/test/standalone/sanity/swm
  platform/src/lib/nicmgr:
    - reference: iota/test/venice
    - reference: iota/test/standalone/precheckin/esx
    - reference: iota/test/standalone/precheckin/linux
    - reference: iota/test/standalone/precheckin/apulu-core
    - reference: iota/test/standalone/precheckin/apulu-sdn-pds
    - reference: iota/test/standalone/sanity/swm
    - reference: nic/apollo/tools/apulu/sanity/base
    - reference: nic/athena/tools/sanity/base
    - reference: iota/test/standalone/precheckin/athena
  platform/src/lib/devapi_iris:
    - reference: iota/test/standalone/precheckin/linux
    - reference: iota/test/standalone/sanity/swm
  platform/src/app/pciemgrd:
    - reference: iota/test/standalone/precheckin/linux
    - reference: nic/apollo/tools/apulu/sanity/base
  platform/src/app/pcieutil/src:
    - reference: iota/test/standalone/precheckin/linux
  platform/src/app/sysmond:
    - reference: iota/test/standalone/precheckin/linux
 # platform:
 #   - reference: nic/apollo
 #     exclude_dirs: ["doc", "drivers"]
 #   - reference: iota/test/venice
 #     exclude_dirs: ["doc", "drivers/linux", "drivers/freebsd"]
 #   - reference: iota/test/standalone/sanity/esx
 #     exclude_dirs: ["doc", "drivers/linux", "drivers/freebsd"]
 #   - reference: iota/test/standalone/sanity/freebsd
 #     exclude_dirs: ["doc", "drivers/linux", "drivers/esxi"]
 #   - reference: iota/test/standalone/precheckin/linux
 #     exclude_dirs: ["doc", "drivers/freebsd", "drivers/esxi"]
  platform/src/third-party/app/pciutils:
    - reference: platform/src/app/pciemgrd
  scripts:
    - reference: test/verify-build
  storage/offload:
    - reference: storage/offload/linux-build-test
  venice:
    - reference: api
    - reference: test/ci_targets/e2e
    - reference: test/ci_targets/e2erollout
      exclude_dirs: ["ui"]
    - reference: test/ci_targets/cloud-e2e
      exclude_dirs: ["ctrler/orchhub", "ui"]
    - reference: iota/test/venice
      exclude_dirs: ["ui"]
  venice/ctrler/orchhub:
    - reference: iota/test/venice/vcenter
  venice/ctrler/npm:
    - reference: iota/test/venice/vcenter
  iota/test/venice/testsuites/vchub:
    - reference: iota/test/venice/vcenter
  iota/test/venice/iotakit/model/vcenter:
    - reference: iota/test/venice/vcenter
    - reference: iota/test/venice
  test:
    - reference: api
    - reference: test/ci_targets/e2e
    - reference: test/ci_targets/e2erollout
    - reference: test/ci_targets/cloud-e2e
      exclude_dirs: ["integ/migrationinteg"]
    - reference: platform
      exclude_dirs: ["integ/migrationinteg"]
  vendor:
    - reference: api
    - reference: venice
    - reference: test/ci_targets/e2e
    - reference: test/ci_targets/e2erollout
    - reference: test/ci_targets/cloud-e2e
  penctl:
    - reference: iota/test/standalone/precheckin/esx
    - reference: iota/test/standalone/precheckin/linux
