// {C} Copyright 2017 Pensando Systems Inc. All rights reserved.

syntax = "proto3";

// Configure and manage the Venice cluster.
package cluster;

import "google/api/annotations.proto";
import  public "github.com/pensando/sw/venice/utils/apigen/annotations/includes.proto";
import "github.com/gogo/protobuf/gogoproto/gogo.proto";
import "cluster.proto";
import "smartnic.proto";
import "tenant.proto";

//-------------------------------- R E S T / g R P C  A P I ----------------------------------------------------

// list of V1 event types supported by the cluster service
enum EventTypesV1 {
    // Leader election events
    ElectionStarted             = 0; // Leader election started in the cluster
    ElectionCancelled           = 1; // Leader election cancelled
    ElectionNotificationFailed  = 2; // Failed to send leader election notification
    ElectionStopped             = 3; // Leader election stopped
    LeaderElected               = 4; // Leader elected for the cluster
    LeaderLost                  = 5; // Node lost leadership during the election
    LeaderChanged               = 6; // Leader changed in the election

    // Node events
    NodeJoined                  = 7; // Node joined the cluster
    NodeDisjoined               = 8; // Node disjoined from the cluster

    // NIC events
    NICAdmitted                 = 9; // NIC admitted to the cluster
}

service ClusterV1 {
    // Prefix for all resources served by this service.
    option (venice.apiPrefix) = "cluster";
    // API Version.
    option (venice.apiVersion) = "v1";

    option(venice.apiGrpcCrudService) = "Cluster";
    option(venice.apiGrpcCrudService) = "Node";
    option(venice.apiGrpcCrudService) = "Host";
    option(venice.apiGrpcCrudService) = "SmartNIC";
    option(venice.apiGrpcCrudService) = "Tenant";

    option (venice.apiRestService) = {
        Object: "Cluster"
        Method: ["put", "get", "delete", "watch"]
    };

    // Action to set auth bootstrap flag once cluster has been bootstrapped with needed auth objects. Once set it cannot be unset.
    option (venice.apiAction) = {
     Object: "Cluster"
     Action: "AuthBootstrapComplete"
     Request: "ClusterAuthBootstrapRequest"
     Response: "Cluster"
    };

    option (venice.apiRestService) = {
        Object: "Node"
        Method: ["put", "get", "delete", "post", "list", "watch"]
    };

    option (venice.apiRestService) = {
        Object: "Host"
        Method: ["put", "get", "delete", "post", "list", "watch"]
    };

    option (venice.apiRestService) = {
        Object: "SmartNIC"
        Method: ["put", "get", "delete", "list", "watch"]
    };

    option (venice.apiRestService) = {
        Object: "Tenant"
        Method: ["get", "put", "delete", "post", "list" , "watch"]
    };

    // name of enums containing event types.
    // e.g: V2 can include "EventTypesV1" and "EventTypesV2" in this list.
    option(venice.eventTypes) = "EventTypesV1";
}
