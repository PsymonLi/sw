# Hitless Upgrade feature test
feature:
    id          : upgrade
    sub         : hitless-fail-preswitch
    package     : test.upgrade
    module      : upgrade
    runorder    : 100
    enable      : True
    ignore      : False

modules:

    - module:
        name    : PACKET_TEST_NEG_NEW_ICMP_FLOW_1_PRE_UPGRADE
        spec    : l2r_icmp_echo_reply_existing_flow.testspec
        iterate :
            - flow : filter://FlType=MAPPING,AddrFamily=IPV4,FwdMode=L3,Label=NETWORKING

    - module:
        name    : PACKET_TEST_NEG_NEW_ICMP_FLOW_2_PRE_UPGRADE
        spec    : l2r_icmp_echo_reply_new_flow.testspec
        iterate :
            - flow : filter://FlType=MAPPING,AddrFamily=IPV4,FwdMode=L3,Label=NETWORKING

    - module:
        name    : UPGRADE_NEG_TRIGGER_HITLESS
        spec    : hitless.testspec
        args    :
           - fields :
              failure_stage  : UPG_STAGE_PRE_SWITCHOVER    # should match with upgtestapp args
              failure_reason : fail                       # should match with upgtestapp args    

    - module:
        name    : PACKET_TEST_NEG_EXISTING_ICMP_FLOW_POST_UPGRADE
        spec    : l2r_icmp_echo_reply_existing_flow.testspec
        iterate :
            - flow : filter://FlType=MAPPING,AddrFamily=IPV4,FwdMode=L3,Label=NETWORKING
        args    :
            - verify_flow_not_created : cli_dom_b.sock

    - module:
        name    : PACKET_TEST_NEG_NEW_ICMP_FLOW_3_POST_UPGRADE
        spec    : l2r_icmp_echo_reply_new_flow.testspec
        iterate :
            - flow : filter://FlType=MAPPING,AddrFamily=IPV4,FwdMode=L3,Label=NETWORKING
