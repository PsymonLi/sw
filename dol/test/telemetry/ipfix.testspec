# Test Spec
selectors:
    src:
        tenant      : filter://overlay=VLAN,type=TENANT
        segment     : filter://native=False
        endpoint    : filter://remote=True
        interface   : filter://any
    dst:
        tenant      : filter://overlay=VLAN,type=TENANT
        segment     : filter://native=False
        endpoint    : filter://remote=True
        interface   : filter://any
    flow        : filter://fwtype=L2,label=IPFIX
    maxflows    : 1

packets:
    - packet:
        id          : IPV4_REC1
        template    : ref://factory/packets/id=IPFIX_RECORD_IPV4
        headers     :
            data    :
                len                     : 136
                vrf                     : 0
                ip_sa                   : 10.1.2.1
                ip_da                   : 11.1.2.1
                proto                   : 6
                sport                   : 0xabba
                dport                   : 0xbeef
                flow_state_index        : 0
                role                    : 0
                ttl                     : 0
                icmp_type_code          : 0
                tcp_seq_num             : 0
                tcp_ack_num             : 0
                tcp_win_sz              : 0
                tcp_win_scale           : 0
                tcp_state               : 0
                tcp_win_mss             : 0
                tcp_exceptions          : 0
                flit_pad1               : 0
                tcp_rtt                 : 0
                flow_id                 : 0xdeaf
                egress_interface        : 0x789
                egress_interface_type   : 0
                permit_packets          : 0x7060504030201010
                permit_bytes            : 0x40302010a0b0c0d0
                delta_permit_packets    : 0
                delta_permit_bytes      : 0
                drop_packets            : 0x0102030405060708
                drop_bytes              : 0x0f0e0d0c0b0a0908
                delta_drop_packets      : 0
                delta_drop_bytes        : 0
                flit_pad2               : 0
                start_timestamp         : 0
                last_seen_timestamp     : 0
                drop_vector             : 0

    - packet:
        id          : IPV4_REC2
        template    : ref://factory/packets/id=IPFIX_RECORD_IPV4
        headers     :
            data    :
                len                     : 136
                vrf                     : 0
                ip_sa                   : 10.1.2.2
                ip_da                   : 11.1.2.2
                proto                   : 6
                sport                   : 0xabbb
                dport                   : 0xbef0
                flow_state_index        : 0
                role                    : 0
                ttl                     : 0
                icmp_type_code          : 0
                tcp_seq_num             : 0
                tcp_ack_num             : 0
                tcp_win_sz              : 0
                tcp_win_scale           : 0
                tcp_state               : 0
                tcp_win_mss             : 0
                tcp_exceptions          : 0
                flit_pad1               : 0
                tcp_rtt                 : 0
                flow_id                 : 0xdeaf
                egress_interface        : 0x789
                egress_interface_type   : 0
                permit_packets          : 0x7060504030201010
                permit_bytes            : 0x40302010a0b0c0d0
                delta_permit_packets    : 0
                delta_permit_bytes      : 0
                drop_packets            : 0x0102030405060708
                drop_bytes              : 0x0f0e0d0c0b0a0908
                delta_drop_packets      : 0
                delta_drop_bytes        : 0
                flit_pad2               : 0
                start_timestamp         : 0
                last_seen_timestamp     : 0
                drop_vector             : 0

    - packet:
        id          : IPV4_REC3
        template    : ref://factory/packets/id=IPFIX_RECORD_IPV4
        headers     :
            data    :
                len                     : 136
                vrf                     : 0
                ip_sa                   : 10.1.2.3
                ip_da                   : 11.1.2.3
                proto                   : 6
                sport                   : 0xabbc
                dport                   : 0xbef1
                flow_state_index        : 0
                role                    : 0
                ttl                     : 0
                icmp_type_code          : 0
                tcp_seq_num             : 0
                tcp_ack_num             : 0
                tcp_win_sz              : 0
                tcp_win_scale           : 0
                tcp_state               : 0
                tcp_win_mss             : 0
                tcp_exceptions          : 0
                flit_pad1               : 0
                tcp_rtt                 : 0
                flow_id                 : 0xdeaf
                egress_interface        : 0x789
                egress_interface_type   : 0
                permit_packets          : 0x7060504030201010
                permit_bytes            : 0x40302010a0b0c0d0
                delta_permit_packets    : 0
                delta_permit_bytes      : 0
                drop_packets            : 0x0102030405060708
                drop_bytes              : 0x0f0e0d0c0b0a0908
                delta_drop_packets      : 0
                delta_drop_bytes        : 0
                flit_pad2               : 0
                start_timestamp         : 0
                last_seen_timestamp     : 0
                drop_vector             : 0

    - packet:
        id          : IPV4_REC4
        template    : ref://factory/packets/id=IPFIX_RECORD_IPV4
        headers     :
            data    :
                len                     : 136
                vrf                     : 0
                ip_sa                   : 10.1.2.4
                ip_da                   : 11.1.2.4
                proto                   : 6
                sport                   : 0xabbd
                dport                   : 0xbef2
                flow_state_index        : 0
                role                    : 0
                ttl                     : 0
                icmp_type_code          : 0
                tcp_seq_num             : 0
                tcp_ack_num             : 0
                tcp_win_sz              : 0
                tcp_win_scale           : 0
                tcp_state               : 0
                tcp_win_mss             : 0
                tcp_exceptions          : 0
                flit_pad1               : 0
                tcp_rtt                 : 0
                flow_id                 : 0xdeaf
                egress_interface        : 0x789
                egress_interface_type   : 0
                permit_packets          : 0x7060504030201010
                permit_bytes            : 0x40302010a0b0c0d0
                delta_permit_packets    : 0
                delta_permit_bytes      : 0
                drop_packets            : 0x0102030405060708
                drop_bytes              : 0x0f0e0d0c0b0a0908
                delta_drop_packets      : 0
                delta_drop_bytes        : 0
                flit_pad2               : 0
                start_timestamp         : 0
                last_seen_timestamp     : 0
                drop_vector             : 0

    - packet:
        id          : IPV4_REC5
        template    : ref://factory/packets/id=IPFIX_RECORD_IPV4
        headers     :
            data    :
                len                     : 136
                vrf                     : 0
                ip_sa                   : 10.1.2.5
                ip_da                   : 11.1.2.5
                proto                   : 6
                sport                   : 0xabbe
                dport                   : 0xbef3
                flow_state_index        : 0
                role                    : 0
                ttl                     : 0
                icmp_type_code          : 0
                tcp_seq_num             : 0
                tcp_ack_num             : 0
                tcp_win_sz              : 0
                tcp_win_scale           : 0
                tcp_state               : 0
                tcp_win_mss             : 0
                tcp_exceptions          : 0
                flit_pad1               : 0
                tcp_rtt                 : 0
                flow_id                 : 0xdeaf
                egress_interface        : 0x789
                egress_interface_type   : 0
                permit_packets          : 0x7060504030201010
                permit_bytes            : 0x40302010a0b0c0d0
                delta_permit_packets    : 0
                delta_permit_bytes      : 0
                drop_packets            : 0x0102030405060708
                drop_bytes              : 0x0f0e0d0c0b0a0908
                delta_drop_packets      : 0
                delta_drop_bytes        : 0
                flit_pad2               : 0
                start_timestamp         : 0
                last_seen_timestamp     : 0
                drop_vector             : 0

    - packet:
        id          : IPV4_REC6
        template    : ref://factory/packets/id=IPFIX_RECORD_IPV4
        headers     :
            data    :
                len                     : 136
                vrf                     : 0
                ip_sa                   : 10.1.2.6
                ip_da                   : 11.1.2.6
                proto                   : 6
                sport                   : 0xabbf
                dport                   : 0xbef4
                flow_state_index        : 0
                role                    : 0
                ttl                     : 0
                icmp_type_code          : 0
                tcp_seq_num             : 0
                tcp_ack_num             : 0
                tcp_win_sz              : 0
                tcp_win_scale           : 0
                tcp_state               : 0
                tcp_win_mss             : 0
                tcp_exceptions          : 0
                flit_pad1               : 0
                tcp_rtt                 : 0
                flow_id                 : 0xdeaf
                egress_interface        : 0x789
                egress_interface_type   : 0
                permit_packets          : 0x7060504030201010
                permit_bytes            : 0x40302010a0b0c0d0
                delta_permit_packets    : 0
                delta_permit_bytes      : 0
                drop_packets            : 0x0102030405060708
                drop_bytes              : 0x0f0e0d0c0b0a0908
                delta_drop_packets      : 0
                delta_drop_bytes        : 0
                flit_pad2               : 0
                start_timestamp         : 0
                last_seen_timestamp     : 0
                drop_vector             : 0

    - packet:
        id          : IPV4_REC7
        template    : ref://factory/packets/id=IPFIX_RECORD_IPV4
        headers     :
            data    :
                len                     : 136
                vrf                     : 0
                ip_sa                   : 10.1.2.7
                ip_da                   : 11.1.2.7
                proto                   : 6
                sport                   : 0xabc0
                dport                   : 0xbef5
                flow_state_index        : 0
                role                    : 0
                ttl                     : 0
                icmp_type_code          : 0
                tcp_seq_num             : 0
                tcp_ack_num             : 0
                tcp_win_sz              : 0
                tcp_win_scale           : 0
                tcp_state               : 0
                tcp_win_mss             : 0
                tcp_exceptions          : 0
                flit_pad1               : 0
                tcp_rtt                 : 0
                flow_id                 : 0xdeaf
                egress_interface        : 0x789
                egress_interface_type   : 0
                permit_packets          : 0x7060504030201010
                permit_bytes            : 0x40302010a0b0c0d0
                delta_permit_packets    : 0
                delta_permit_bytes      : 0
                drop_packets            : 0x0102030405060708
                drop_bytes              : 0x0f0e0d0c0b0a0908
                delta_drop_packets      : 0
                delta_drop_bytes        : 0
                flit_pad2               : 0
                start_timestamp         : 0
                last_seen_timestamp     : 0
                drop_vector             : 0

    - packet:
        id          : IPV4_REC8
        template    : ref://factory/packets/id=IPFIX_RECORD_IPV4
        headers     :
            data    :
                len                     : 136
                vrf                     : 0
                ip_sa                   : 10.1.2.8
                ip_da                   : 11.1.2.8
                proto                   : 6
                sport                   : 0xabc1
                dport                   : 0xbef6
                flow_state_index        : 0
                role                    : 0
                ttl                     : 0
                icmp_type_code          : 0
                tcp_seq_num             : 0
                tcp_ack_num             : 0
                tcp_win_sz              : 0
                tcp_win_scale           : 0
                tcp_state               : 0
                tcp_win_mss             : 0
                tcp_exceptions          : 0
                flit_pad1               : 0
                tcp_rtt                 : 0
                flow_id                 : 0xdeaf
                egress_interface        : 0x789
                egress_interface_type   : 0
                permit_packets          : 0x7060504030201010
                permit_bytes            : 0x40302010a0b0c0d0
                delta_permit_packets    : 0
                delta_permit_bytes      : 0
                drop_packets            : 0x0102030405060708
                drop_bytes              : 0x0f0e0d0c0b0a0908
                delta_drop_packets      : 0
                delta_drop_bytes        : 0
                flit_pad2               : 0
                start_timestamp         : 0
                last_seen_timestamp     : 0
                drop_vector             : 0

    - packet:
        id          : IPV4_REC9
        template    : ref://factory/packets/id=IPFIX_RECORD_IPV4
        headers     :
            data    :
                len                     : 136
                vrf                     : 0
                ip_sa                   : 10.1.2.9
                ip_da                   : 11.1.2.9
                proto                   : 6
                sport                   : 0xabc2
                dport                   : 0xbef7
                flow_state_index        : 0
                role                    : 0
                ttl                     : 0
                icmp_type_code          : 0
                tcp_seq_num             : 0
                tcp_ack_num             : 0
                tcp_win_sz              : 0
                tcp_win_scale           : 0
                tcp_state               : 0
                tcp_win_mss             : 0
                tcp_exceptions          : 0
                flit_pad1               : 0
                tcp_rtt                 : 0
                flow_id                 : 0xdeaf
                egress_interface        : 0x789
                egress_interface_type   : 0
                permit_packets          : 0x7060504030201010
                permit_bytes            : 0x40302010a0b0c0d0
                delta_permit_packets    : 0
                delta_permit_bytes      : 0
                drop_packets            : 0x0102030405060708
                drop_bytes              : 0x0f0e0d0c0b0a0908
                delta_drop_packets      : 0
                delta_drop_bytes        : 0
                flit_pad2               : 0
                start_timestamp         : 0
                last_seen_timestamp     : 0
                drop_vector             : 0

    - packet:
        id          : IPV4_REC10
        template    : ref://factory/packets/id=IPFIX_RECORD_IPV4
        headers     :
            data    :
                len                     : 136
                vrf                     : 0
                ip_sa                   : 10.1.2.10
                ip_da                   : 11.1.2.10
                proto                   : 6
                sport                   : 0xabc3
                dport                   : 0xbef8
                flow_state_index        : 0
                role                    : 0
                ttl                     : 0
                icmp_type_code          : 0
                tcp_seq_num             : 0
                tcp_ack_num             : 0
                tcp_win_sz              : 0
                tcp_win_scale           : 0
                tcp_state               : 0
                tcp_win_mss             : 0
                tcp_exceptions          : 0
                flit_pad1               : 0
                tcp_rtt                 : 0
                flow_id                 : 0xdeaf
                egress_interface        : 0x789
                egress_interface_type   : 0
                permit_packets          : 0x7060504030201010
                permit_bytes            : 0x40302010a0b0c0d0
                delta_permit_packets    : 0
                delta_permit_bytes      : 0
                drop_packets            : 0x0102030405060708
                drop_bytes              : 0x0f0e0d0c0b0a0908
                delta_drop_packets      : 0
                delta_drop_bytes        : 0
                flit_pad2               : 0
                start_timestamp         : 0
                last_seen_timestamp     : 0
                drop_vector             : 0

    - packet:
        id          : IPV4_REC11
        template    : ref://factory/packets/id=IPFIX_RECORD_IPV4
        headers     :
            data    :
                len                     : 136
                vrf                     : 0
                ip_sa                   : 10.1.2.11
                ip_da                   : 11.1.2.11
                proto                   : 6
                sport                   : 0xabc4
                dport                   : 0xbef9
                flow_state_index        : 0
                role                    : 0
                ttl                     : 0
                icmp_type_code          : 0
                tcp_seq_num             : 0
                tcp_ack_num             : 0
                tcp_win_sz              : 0
                tcp_win_scale           : 0
                tcp_state               : 0
                tcp_win_mss             : 0
                tcp_exceptions          : 0
                flit_pad1               : 0
                tcp_rtt                 : 0
                flow_id                 : 0xdeaf
                egress_interface        : 0x789
                egress_interface_type   : 0
                permit_packets          : 0x7060504030201010
                permit_bytes            : 0x40302010a0b0c0d0
                delta_permit_packets    : 0
                delta_permit_bytes      : 0
                drop_packets            : 0x0102030405060708
                drop_bytes              : 0x0f0e0d0c0b0a0908
                delta_drop_packets      : 0
                delta_drop_bytes        : 0
                flit_pad2               : 0
                start_timestamp         : 0
                last_seen_timestamp     : 0
                drop_vector             : 0

    - packet:
        id          : EPKT
        template    : ref://factory/packets/id=IPFIX
        encaps      :
            - ref://factory/packets/id=ENCAP_QTAG
        headers     :
            eth     :
                src             : 00:cc:00:00:00:02
                dst             : 00:ee:ff:00:00:02
            qtag    :
                vlan            : 2
            ipv4    :
                src             : 64.0.0.4
                dst             : 64.0.0.1
                id              : 0
            udp     :
                sport           : 32007
                dport           : 4739
            ipfix   :
                version         : 0
                len             : 0
                export_time     : 0
                seq_num         : 0
                domain_id       : 0
                records         :
                    - record: ref://testcase/packets/id=IPV4_REC1/rawbytes
                    - record: ref://testcase/packets/id=IPV4_REC2/rawbytes
                    - record: ref://testcase/packets/id=IPV4_REC3/rawbytes
                    - record: ref://testcase/packets/id=IPV4_REC4/rawbytes
                    - record: ref://testcase/packets/id=IPV4_REC5/rawbytes
                    - record: ref://testcase/packets/id=IPV4_REC6/rawbytes
                    - record: ref://testcase/packets/id=IPV4_REC7/rawbytes
                    - record: ref://testcase/packets/id=IPV4_REC8/rawbytes
                    - record: ref://testcase/packets/id=IPV4_REC9/rawbytes
                    - record: ref://testcase/packets/id=IPV4_REC10/rawbytes
                    - record: ref://testcase/packets/id=IPV4_REC11/rawbytes

    - packet:
        id          : ECPUPKT
        template    : ref://factory/packets/id=IPFIX
        encaps      :
            - ref://factory/packets/id=ENCAP_QTAG
        headers     :
            eth     :
                src             : 00:cc:00:00:00:02
                dst             : 00:ee:ff:00:00:02
            qtag    :
                prio            : 0
                vlan            : 1
            ipv4    :
                src             : 64.0.0.4
                dst             : 64.0.0.1
                id              : 0
                tos             : 0
            udp     :
                sport           : 32007
                dport           : 4739
            ipfix   :
                version         : 0
                len             : 0
                export_time     : 0
                seq_num         : 0
                domain_id       : 0
                records         :
                    - record: ref://testcase/packets/id=IPV4_REC1/rawbytes
                    - record: ref://testcase/packets/id=IPV4_REC2/rawbytes
                    - record: ref://testcase/packets/id=IPV4_REC3/rawbytes
                    - record: ref://testcase/packets/id=IPV4_REC4/rawbytes
                    - record: ref://testcase/packets/id=IPV4_REC5/rawbytes
                    - record: ref://testcase/packets/id=IPV4_REC6/rawbytes
                    - record: ref://testcase/packets/id=IPV4_REC7/rawbytes
                    - record: ref://testcase/packets/id=IPV4_REC8/rawbytes
                    - record: ref://testcase/packets/id=IPV4_REC9/rawbytes
                    - record: ref://testcase/packets/id=IPV4_REC10/rawbytes
                    - record: ref://testcase/packets/id=IPV4_REC11/rawbytes

trigger:

expect:
    delay           : callback://networking/packets/GetExpectDelay
    packets:
        - packet:
            object  : ref://testcase/packets/id=EPKT
            port    : 1
        - packet:
            object  : callback://networking/packets/GetCpuPacket/expktid=ECPUPKT
            port    : 128

