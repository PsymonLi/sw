alias_group5:
  #- alias: 'input_uncompressed=input_uncompressed.bin'
  #- alias: 'input_compressed=input_compressed.bin'
  #- alias: 'output_compressed=input_compressed.bin'
  - alias: 'input_uncompressed=/dev/pencakefd0'
  - alias: 'input_compressed=/dev/pencakefd1'
  - alias: 'output_compressed=/dev/pencakefd1'
  - alias: 'pattern1=0x6d6d6d6d6d6d6d6d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000'

svc_chains:
  - svc_chain:
      idx: 1
      input:
        pattern: '$pattern1'
        len: '$2block'
        output_file: '$input_uncompressed'
      ops:
        - compress:
            flags: 'zero_pad,insert_header'
            hdr_fmt_idx: 1
            threshold_delta: 8
            output_file: '$output_compressed'
 
  - svc_chain:
      idx: 2
      input:
        file: '$input_compressed'
      ops:
        - decompress:
            flags: 'header_present'
            hdr_fmt_idx: 1
            output_file: '%chain_id%_decompressed.bin'

  - svc_chain:
      idx: 3
      input:
        # 0xd106b591 d1030100
        #pattern: >-
        #  0xfaff6d0401000f010f010f010f010f010f010f010f010f010f010f010f010f01ffff0f010f010f010f010f010f010f010f010f010f010f010f010f010f010f010f01ffff0f010f010f010f010f010f010f010f010f010f010f010f010f010f010f010f01ffff0f010f010f010f010f010f010f010f010f010f010f010f010f010f010f010f01ffff0f010f010f010f010f010f010f010f010f010f010f010f010f010f010f010f01ffff0f010f010f010f010f010f010f010f010f010f010f010f010f010f010f010f01ffff0f010f010f010f010f010f010f010f010f010f010f010f010f010f010f010f01ffff0f010f010f010f010f010f010f010f010f010f010f010f010f010f010f010f01ffff0f010f010f010f010f010f010f010f010f010f010f010f010f010f010f010f01ffff0f010f010f010f010f010f010f010f010f010f010f010f010f010f010f010f01ffff0f010f010f010f010f010f010f010f010f010f010f010f010f010f010f010f01ffff0f010f010f010f010f010f010f010f010f010f010f010f010f010f010f010f01ffff0f010f010f010f010f010f010f010f010f010f010f010f010f010f010f010f01ffff0f010f010f010f010f010f010f010f010f010f010f010f010f010f010f010f01bfff0f010f010f010f010f010f0100f0fb0201000b0f010f010f010f010f010f01ffff0f010f010f010f010f010f010f010f010f010f010f010f010f010f010f010f01ffff0f010f010f010f010f010f010f010f010f010f010f010f010f010f010f010f01ffff0f010f010f010f010f010f010f010f010f010f010f010f010f010f010f010f01ffff0f010f010f010f010f010f010f010f010f010f010f010f010f010f010f010f01ffff0f010f010f010f010f010f010f010f010f010f010f010f010f010f010f010f01ffff0f010f010f010f010f010f010f010f010f010f010f010f010f010f010f010f01ffff0f010f010f010f010f010f010f010f010f010f010f010f010f010f010f010f01ffff0f010f010f010f010f010f010f010f010f010f010f010f010f010f010f010f01ffff0f010f010f010f010f010f010f010f010f010f010f010f010f010f010f010f01ffff0f010f010f010f010f010f010f010f010f010f010f010f010f010f010f010f01ffff0f010f010f010f010f010f010f010f010f010f010f010f010f010f010f010f01ffff0f010f010f010f010f010f010f010f010f010f010f010f010f010f010f010f01ffff0f010f010f010f010f010f010f010f010f010f010f010f010f010f010f010f01ff1f0f010f010f010f010f010f010f010f010f010f010f010f010e01
        file: '$input_compressed'
        offset: 8
        #output_file: 'hw1_compressed.bin'
      ops:
        - decompress:
            #flags: 'header_present'
            flags: 0
            hdr_fmt_idx: 1
            output_file: '%chain_id%_decompressed.bin'

  - svc_chain:
      idx: 4
      input:
        # 0xd106b591 cc030100
        #pattern: >-
        #  0xfaff6d0401000f010f010f010f010f010f010f010f010f010f010f010f010f01ffff0f010f010f010f010f010f010f010f010f010f010f010f010f010f010f010f01ffff0f010f010f010f010f010f010f010f010f010f010f010f010f010f010f010f01ffff0f010f010f010f010f010f010f010f010f010f010f010f010f010f010f010f01ffff0f010f010f010f010f010f010f010f010f010f010f010f010f010f010f010f01ffff0f010f010f010f010f010f010f010f010f010f010f010f010f010f010f010f01ffff0f010f010f010f010f010f010f010f010f010f010f010f010f010f010f010f01ffff0f010f010f010f010f010f010f010f010f010f010f010f010f010f010f010f01ffff0f010f010f010f010f010f010f010f010f010f010f010f010f010f010f010f01ffff0f010f010f010f010f010f010f010f010f010f010f010f010f010f010f010f01ffff0f010f010f010f010f010f010f010f010f010f010f010f010f010f010f010f01ffff0f010f010f010f010f010f010f010f010f010f010f010f010f010f010f010f01ffff0f010f010f010f010f010f010f010f010f010f010f010f010f010f010f010f01ffff0f010f010f010f010f010f010f010f010f010f010f010f010f010f010f010f01ffff0f010f010f010f010f010f010f000f010f010f010f010f010f010f010f010f01ffff0f010f010f010f010f010f010f010f010f010f010f010f010f010f010f010f01ffff0f010f010f010f010f010f010f010f010f010f010f010f010f010f010f010f01ffff0f010f010f010f010f010f010f010f010f010f010f010f010f010f010f010f01ffff0f010f010f010f010f010f010f010f010f010f010f010f010f010f010f010f01ffff0f010f010f010f010f010f010f010f010f010f010f010f010f010f010f010f01ffff0f010f010f010f010f010f010f010f010f010f010f010f010f010f010f010f01ffff0f010f010f010f010f010f010f010f010f010f010f010f010f010f010f010f01ffff0f010f010f010f010f010f010f010f010f010f010f010f010f010f010f010f01ffff0f010f010f010f010f010f010f010f010f010f010f010f010f010f010f010f01ffff0f010f010f010f010f010f010f010f010f010f010f010f010f010f010f010f01ffff0f010f010f010f010f010f010f010f010f010f010f010f010f010f010f010f01ffff0f010f010f010f010f010f010f010f010f010f010f010f010f010f010f010f01ffff0f010f010f010f010f010f010f010f010f010f010f010f010f010f010f010f01ff030f010f010f010f010f010f010f010f010f010801
        #output_file: 'hw2_compressed.bin'
        file: '$input_compressed'
        offset: 8
      ops:
        - decompress:
            #flags: 'header_present'
            flags: 0
            hdr_fmt_idx: 1
            output_file: '%chain_id%_decompressed.bin'
            output_len: '$2block'

  - svc_chain:
      idx: 5
      input:
        random: start_time
        random_len: 128
        len: '$2block'
        output_file: 'random_input.bin'
      ops:
        - compress:
            flags: 'zero_pad,insert_header'
            hdr_fmt_idx: 1
            threshold_delta: 8
            output_file: 'random_compressed.bin'
 
  - svc_chain:
      idx: 6
      input:
        file: 'random_compressed.bin'
      ops:
        - decompress:
            flags: 'header_present'
            hdr_fmt_idx: 1
            output_file: 'random_decompressed.bin'

  - svc_chain:
      idx: 7
      input:
        pattern: '$pattern1'
        len: '$2block'
      ops:
        - compress:
            flags: 'zero_pad,insert_header'
            hdr_fmt_idx: 1
            threshold_delta: 8
            output_file: '%test_id%_hdr_compressed.bin'

  - svc_chain:
      idx: 8
      input:
        file: '7_hdr_compressed.bin'
        offset: 0
      ops:
        - decompress:
            flags: 'header_present'
            hdr_fmt_idx: 1
            output_file: '%test_id%_decompressed.bin'
            output_len: 16384

  - svc_chain:
      idx: 9
      input:
        random: 'req_time'
        random_len: 'range(128, 8192, 128)'
        len: '$2block'
        output_file: '9_uncompressed.bin'
      mode: 'poll'
      ops:
        - compress:
            flags: 'zero_pad,insert_header'
            hdr_fmt_idx: 1
            threshold: 4088
            output_file: '%test_id%_hw_compressed.bin'
  - svc_chain:
      idx: 19
      input:
        file: '9_uncompressed.bin'
      mode: 'sim'
      ops:
        - compress:
            flags: 'zero_pad,insert_header'
            hdr_fmt_idx: 1
            threshold: 4088
            output_file: '%test_id%_sim_compressed.bin'

tests:
  - test:
      idx: 1
      svc_chains: 1
      repeat: '$iter_low'
      validations:
        - retcode_compare:
            idx: 1
            retcode: 0
            svc_retcodes: 0
        - size_compare:
            idx: 2
            file1: '$output_compressed'
            val: 1018
        - data_compare:
            idx: 3
            file1: '$output_compressed'
            pattern: 0x00
            offset: eof
            len: eob
        - data_compare:
            idx: 4
            file1: '$output_compressed'
            pattern: 0xe005f377f2030100
            #pattern: 0xd106b591d1030100
            len: 8
        - data_input_compare:
            idx: 5
            #file1: '$input_uncompressed'
            pattern: 0x6d6d6d6d6d6d6d6d0000000000000000
            len: 16
        - data_output_compare:
            idx: 6
            file1: '$input_compressed'
            len: 8

  - test:
      idx: 2
      svc_chains: 2
      repeat: '$iter_low'
      validations:
        - retcode_compare:
            idx: 1
            retcode: 0
            svc_retcodes: 0
        - size_compare:
            idx: 2
            file1: '2_decompressed.bin'
            val: '$2block'
        - data_compare:
            idx: 3
            file1: '2_decompressed.bin'
            file2: '$input_uncompressed'
            len: '$2block'
  - test:
      idx: 3
      svc_chains: 3
      repeat: '$iter_low'
      validations:
        - retcode_compare:
            idx: 1
            retcode: 0
            svc_retcodes: 0
        - size_compare:
            idx: 2
            file1: '3_decompressed.bin'
            val: '$2block'
        - data_compare:
            idx: 3
            file1: '3_decompressed.bin'
            file2: '$input_uncompressed'
            len: '$2block'
  - test:
      idx: 4
      svc_chains: 4
      repeat: '$iter_low'
      validations:
        - retcode_compare:
            idx: 1
            retcode: 0
            svc_retcodes: 0
        - size_compare:
            idx: 2
            file1: '4_decompressed.bin'
            val: '$2block'
        - data_compare:
            idx: 3
            file1: '4_decompressed.bin'
            file2: '$input_uncompressed'
            len: '$2block'
  - test:
      idx: 5
      svc_chains: 5
      repeat: '$iter_low'
      validations:
        - retcode_compare:
            idx: 1
            retcode: 0
            svc_retcodes: 0
        - data_compare:
            idx: 2
            file1: 'random_compressed.bin'
            pattern: 0x00
            offset: eof
            len: eob
        - data_input_compare:
            idx: 3
            file1: 'random_input.bin'
            #pattern: 0x00
            #len: 1
        - data_output_compare:
            idx: 4
            file1: 'random_compressed.bin'
            #pattern: 0xff
            len: 8
        - data_compare:
            idx: 5
            file1: 'random_compressed.bin'
            pattern: 0x0100
            offset: 6
            len: 2
        - data_output_compare:
            idx: 6
            pattern: 0x00
            offset: eof
            len: eob

  - test:
      idx: 6
      svc_chains: 6
      repeat: '$iter_low'
      validations:
        - retcode_compare:
            idx: 1
            retcode: 0
            svc_retcodes: 0
        - size_compare:
            idx: 2
            file1: 'random_decompressed.bin'
            val: '$2block'
        - data_output_compare:
            idx: 3
            file1: 'random_input.bin'
            #file1: 'random_compressed.bin'
  - test:
      idx: 7
      svc_chains: 7
      mode: 'async'
      repeat: '$iter_low'
      validations:
        - retcode_compare:
            idx: 1
            retcode: 0
            svc_retcodes: 0
        - data_compare:
            idx: 3
            file1: '7_hdr_compressed.bin'
            file2: '$input_compressed'
  - test:
      idx: 17
      svc_chains: 7
      mode: 'sim'
      repeat: '$iter_low'
      validations:
        - retcode_compare:
            idx: 1
            retcode: 0
            svc_retcodes: 0
        - size_compare:
            idx: 2
            file1: '17_hdr_compressed.bin'
            file2: '7_hdr_compressed.bin'
        - data_compare:
            idx: 3
            file1: '17_hdr_compressed.bin'
            file2: '7_hdr_compressed.bin'
  - test:
      idx: 8
      svc_chains: 8
      mode: 'async'
      repeat: '$iter_low'
      validations:
        - retcode_compare:
            idx: 1
            retcode: 0
            svc_retcodes: 0
        - size_compare:
            idx: 3
            file1: '8_decompressed.bin'
            val: '$2block'
        - data_output_compare:
            idx: 2
            file1: '$input_uncompressed'
  - test:
      idx: 18
      svc_chains: 8
      mode: 'sim'
      repeat: '$iter_low'
      validations:
        - retcode_compare:
            idx: 1
            retcode: 0
            svc_retcodes: 0
        - size_compare:
            idx: 2
            file1: '18_decompressed.bin'
            val: '$2block'
        - data_output_compare:
            idx: 3
            file1: '$input_uncompressed'
  - test:
      idx: 19
      svc_chains: '9,19'
      repeat: 1000
      validations:
        - retcode_compare:
            idx: 1
            svc_chain: 9
            type: ez
            retcode: 20004
            svc_retcodes: 20004
        - retcode_compare:
            idx: 2
            svc_chain: 19
            type: ez
            retcode: 20005
            svc_retcodes: 20005
        - data_len_compare:
            idx: 3
            type: gz
            val: 128
        - data_compare:
            idx: 4
            svc_chain: 9
            file1: '19_hw_compressed.bin'
            file2: '19_sim_compressed.bin'
