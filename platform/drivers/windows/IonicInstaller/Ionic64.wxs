<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi" xmlns:difxapp="http://schemas.microsoft.com/wix/DifxAppExtension">
  <Product Id="b4d5c79e-967b-446a-94a3-5fb6add40028" Name="Ionic NDIS miniport" Language="1033" Version="$(env.IONIC_VERSION_MAJOR).$(env.IONIC_VERSION_MINOR).$(env.IONIC_VERSION_SP).$(env.IONIC_VERSION_BUILD)" Manufacturer="Pensando Systems" UpgradeCode="a13e47d8-4da5-4249-8a4d-d060deaeb27f">
    <Package Id="*" Keywords="Installer" Comments="Copyright (c) Pensando Systems All rights reserved." Description="Ionic NDIS miniport Installer" InstallerVersion="200" Languages="1033" Compressed="yes" InstallScope="perMachine" />

    <MajorUpgrade DowngradeErrorMessage="A newer version of Ionic NDIS miniport is already installed." />
    <Media Id="1" Cabinet="PensandoIonicMiniport.cab" EmbedCab="yes" />
        <Feature Id="Complete" Title="IonicDrvSetup" Description="Ionic NDIS Miniport Installation Package" Display="expand" Level="1" ConfigurableDirectory="INSTALLDIR" AllowAdvertise="no" Absent="disallow">
          <Feature Id="MainDrivers" Title="Ionic driver" Description="Ionic NDIS miniport driver" Level="1" Absent="disallow" AllowAdvertise="no">
            <ComponentRef Id="IonicDriverPackage" />
          </Feature>
          <Feature Id="CommandLineTools" Title="Command line Tools" Description="Command line tools" Level="1" AllowAdvertise="no">
            <ComponentRef Id="IonicConfig" />
            <ComponentRef Id="PensandooToolsCmd" />
            <ComponentRef Id="ProgramMenuDir" />
          </Feature>
       </Feature>
  </Product>

  <Fragment>
    <Directory Id="TARGETDIR" Name="SourceDir">
      <!--
      <Directory Id="ProgramFilesFolder">
        <Directory Id="INSTALLFOLDER" Name="IonicInstaller" />
      </Directory>
      -->
            <Directory Id="ProgramFiles64Folder">
                <Directory Id="Pensando" Name="Pensando Systems">
                    <Directory Id="INSTALLDIR" Name="Pensando Driver Tools">
                        <Component Id="PensandooToolsCmd">
                          <File Id="PensandoToolsCmdBAT" Source="BuildFiles\PensandoToolsCmd.bat" KeyPath="yes">
                            <Shortcut Id="DesktopPensandooToolsCmd" Directory="DesktopFolder" Name="PensandooToolsCmd" WorkingDirectory="INSTALLDIR" Advertise="yes" Icon="Cmd.ico" IconIndex="0" />
                            <Shortcut Id="StartMenuPensandooToolsCmd" Directory="ProgramMenuDir" Name="PensandooToolsCmd" WorkingDirectory="INSTALLDIR" Advertise="yes" Icon="Cmd.ico" IconIndex="0" />
                          </File>
                          <Environment Id="PATH" Name="PATH" Value="[INSTALLDIR]" Permanent="no" Part="last" Action="set" System="yes" />
                        </Component>
                        <Component Id="IonicConfig">
                            <File Id="IonicConfigEXE" Name="$(var.Config Tool.TargetFileName)" Source="$(var.Config Tool.TargetPath)" KeyPath="yes" />
                          <!--Source="BuildFiles\IonicConfig.exe"-->
                        </Component>
                      <Directory Id="Ionic64" Name="Ionic64">
                            <Component Id="IonicDriverPackage" Guid="B0F10226-F3CD-4C3B-814E-BBB95B763360">
                                <difxapp:Driver AddRemovePrograms="no" DeleteFiles="yes" ForceInstall="yes" Legacy="no" PlugAndPlayPrompt="no" Sequence="0" />
                                <File Id="Ionic64InfFile" Source="$(var.SolutionDir)\$(var.Ionic.Platform)\$(var.Ionic.Configuration)\Ionic\Ionic64.inf" KeyPath="yes" />
                                <!-- <File Id="Ionic64VfInfFile" Source="BuildFiles\Ionic64_vf.inf" KeyPath="no" /> -->
                                <File Id="Ionic64CatFile" Source="$(var.SolutionDir)\$(var.Ionic.Platform)\$(var.Ionic.Configuration)\Ionic\Ionic64.cat" KeyPath="no" />
                                <File Id="Ionic64SysFile" Source="$(var.SolutionDir)\$(var.Ionic.Platform)\$(var.Ionic.Configuration)\Ionic\Ionic64.sys" KeyPath="no" />
                            </Component>
                        </Directory>
                    </Directory>
                </Directory>
            </Directory>

            <Directory Id="ProgramMenuFolder" Name="Programs">
                <Directory Id="ProgramMenuDir" Name="Ionic Tools">
                    <Component Id="ProgramMenuDir">
                        <RemoveFolder Id="ProgramMenuDir" On="uninstall" />
                        <RegistryValue Root="HKCU" Key="Software\Pensando Systems\Ionic" Type="string" Value="" KeyPath="yes" />
                    </Component>
                </Directory>
            </Directory>

            <Directory Id="DesktopFolder" />
    
    </Directory>
    
        <WixVariable Id="WixUILicenseRtf" Value="BuildFiles\License.rtf" />
    
        <UI Id='Mondo'>
          <UIRef Id="WixUI_Mondo" />
          <UIRef Id="WixUI_ErrorProgressText" />
                  
          <Publish Dialog="WelcomeDlg" Control="Next" Event="NewDialog" Value="LicenseAgreementDlg" Order="3">1</Publish>
          <Publish Dialog="LicenseAgreementDlg" Control="Back" Event="NewDialog" Value="SetupTypeDlg" Order="3">1</Publish>
      <Publish Dialog="SetupTypeDlg" Control="Back" Event="NewDialog" Value="WelcomeDlg" Order="3">1</Publish>
        </UI>

    
      <Condition Message="Windows Server 20016 64 bit">VersionNT64 &gt;= 603</Condition>
        <Icon Id="Cmd.ico" SourceFile="BuildFiles\Cmd.ico" />
  
  </Fragment>
  
<!--
  <Fragment>
    <ComponentGroup Id="ProductComponents" Directory="INSTALLDIR">
-->    
      <!-- TODO: Remove the comments around this Component element and the ComponentRef below in order to add resources to this installer. -->
      <!-- <Component Id="ProductComponent"> -->
        <!-- TODO: Insert files, registry keys, and other resources here. -->
      <!-- </Component> -->
<!--
    </ComponentGroup>
  </Fragment>
-->
</Wix>
