meta:
    name        : storage::regression
    os          : [ linux, freebsd ]

aliases:
    - &STORAGE_TEST_DIR storage/offload/src/test
    - &BLOCK_SIZE_2K 2048
    - &BLOCK_SIZE_4K 4096
    - &BLOCK_SIZE_8K 8192
    - &BLOCK_SIZE_16K 16384
    - &BLOCK_SIZE_32K 32768
    - &CPUS_ITER_LIST [ 1, 2, 4, 6, 8 ]
    - &BATCH_DEPTH_ITER_LIST_TO256 [ 1, 16, 31, 32, 33, 64, 128, 256 ]
    - &BATCH_DEPTH_ITER_LIST_TO32 [ 1, 16, 31, 32 ]
    - &BATCH_DEPTH_ITER_LIST_TO16 [ 1, 16 ]
    - &MODE_ITER_LIST [ sync, poll, async ]
    - &CPDC_TEST_YML cpdc.yml

testcases:
    -   name    : CompileInsmodSonicPencake
        testcase: testcases.storage.compile_install_drivers
        args    :
            package: storage/gen/storage-offload.tar.xz
            maxcpus: 8

    -   name: CompressDecompress4K
        testcase    : testcases.storage.ymltest2
        iterators   :
            type        : nested
            cpus        : *CPUS_ITER_LIST
            mode        : *MODE_ITER_LIST
            batch_depth : *BATCH_DEPTH_ITER_LIST_TO256
        args    :
            blocksize   : *BLOCK_SIZE_4K
            test        : *CPDC_TEST_YML

    -   name: CompressDecompress8K
        testcase    : testcases.storage.ymltest2
        iterators   :
            type        : nested
            cpus        : *CPUS_ITER_LIST
            mode        : *MODE_ITER_LIST
            batch_depth : *BATCH_DEPTH_ITER_LIST_TO256
        args    :
            blocksize   : *BLOCK_SIZE_8K
            test        : *CPDC_TEST_YML

    -   name: CompressDecompress16K
        testcase    : testcases.storage.ymltest2
        iterators   :
            type        : nested
            cpus        : *CPUS_ITER_LIST
            mode        : *MODE_ITER_LIST
            batch_depth : *BATCH_DEPTH_ITER_LIST_TO32
        args    :
            blocksize   : *BLOCK_SIZE_16K
            test        : *CPDC_TEST_YML

    -   name: CompressDecompress32K
        testcase    : testcases.storage.ymltest2
        iterators   :
            type        : nested
            cpus        : *CPUS_ITER_LIST
            mode        : *MODE_ITER_LIST
            batch_depth : *BATCH_DEPTH_ITER_LIST_TO16
        args    :
            blocksize   : *BLOCK_SIZE_32K
            test        : *CPDC_TEST_YML


    -   name    : CompressFail
        testcase: testcases.storage.ymltest
        args    :
            dir     : *STORAGE_TEST_DIR
            wait    : 5 # Wait in seconds.
            cfg     : [ 4k.yml, globals.yml ]
            test    : cp_fail.yml
            failtest: True

    -   name    : DecompressFail
        testcase: testcases.storage.ymltest
        args    :
            dir     : *STORAGE_TEST_DIR
            wait    : 5 # Wait in seconds.
            cfg     : [ 4k.yml, globals.yml ]
            test    : dc_fail.yml
            failtest: True

    -   name    : Hash
        testcase: testcases.storage.ymltest
        args    :
            dir : *STORAGE_TEST_DIR
            wait: 5 # Wait in seconds.
            cfg : [ 4k.yml, globals.yml ]
            test: hash.yml

    -   name    : Checksum
        testcase: testcases.storage.ymltest
        args    :
            dir : *STORAGE_TEST_DIR
            wait: 5 # Wait in seconds.
            cfg : [ 4k.yml, globals.yml ]
            test: chksum.yml

#    -   name    : Crypto
#        testcase: testcases.storage.ymltest
#        enable  : False
#        args    :
#            dir : *STORAGE_TEST_DIR
#            wait: 5 # Wait in seconds.
#            cfg : [ 4k.yml, globals.yml ]
#            test: crypto1.yml
#
#    -   name    : CryptoFail
#        testcase: testcases.storage.ymltest
#        enable  : False
#        args    :
#            dir : *STORAGE_TEST_DIR
#            wait: 5 # Wait in seconds.
#            cfg : [ 4k.yml, globals.yml ]
#            test: crypto_fail.yml
#
#    -   name    : Test3
#        testcase: testcases.storage.ymltest
#        enable  : False
#        args    :
#            dir : *STORAGE_TEST_DIR
#            wait: 5 # Wait in seconds.
#            cfg : [ 4k.yml, globals.yml ]
#            test: test3.yml

teardown:
    #- step      : verif.utils.collect_logs_and_cores
