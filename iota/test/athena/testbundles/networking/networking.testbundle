meta:
    name    : networking
    os      : [ linux ]
    nics    : [ pensando ]

testcases:
    -   name    : Verify_Athena_App_Running_No_DPDK
        testcase: testcases.networking.athena_app_no_dpdk_verify
        enable  : True

    -   name    : KNI_Klm_Check
        testcase: testcases.networking.kni_klm
        enable  : True

    -   name    : Setup_KNI
        testcase: testcases.networking.kni_setup
        enable  : True

    -   name    : Verify_KNI_Traffic
        testcase: testcases.networking.kni_traffic
        enable  : True
        iterators :
            type         : nested
            traffic_type : ['ping', 'TCP', 'UDP']

    -   name    : Teardown_KNI
        testcase: testcases.networking.kni_teardown
        enable  : True

    -   name    : Pdsctl_Port_Cmd
        testcase: testcases.networking.pdsctl_port
        enable  : True

    -   name    : Pdsctl_Show_Cmd
        testcase: testcases.networking.pdsctl_show
        enable  : True

    -   name    : Policy_Custom_2_flows
        testcase: testcases.networking.policy
        enable  : True
        args    :
            type    : policy_2

    -   name    : Policy_Custom_2M_flows
        testcase: testcases.networking.policy
        enable  : True
        args    :
            type    : policy_2M

    #=======================================
    # Data Path Test
    #=======================================

    -   name    : Generate_DP_Policy
        testcase: testcases.networking.generate_dp_policy
        enable  : True

        # UDP/TCP/ICMP max dyn flows = 4M
        # NAT UDP/TCP max dyn flows ~ 130K, ICMP = 512 
        # flow_cnt specified in Data_Path_Test should not
        # exceed max_dyn_flow_count specified below

    -   name    : Flow_Gen
        testcase: testcases.networking.config.flow_gen
        enable  : True
        args    :
            max_dyn_flow_count : 64

    -   name    : L3_Data_Path_Test
        testcase: testcases.networking.data_path
        enable  : True
        iterators :
            type     : nested
            vnic_type : ['L3']
            nat       : ['no']
            proto     : ['UDP', 'TCP', 'ICMP']
            pyld_size : [64, 1024]
            flow_type : ['dynamic']
            bidir     : ['yes']
        args    :
            flow_cnt  : 1
            pkt_cnt   : 10

    -   name    : L3_NAT_Data_Path_Test
        testcase: testcases.networking.data_path
        enable  : True
        iterators :
            type     : nested
            vnic_type : ['L3']
            nat       : ['yes']
            proto     : ['UDP', 'TCP', 'ICMP']
            pyld_size : [1024, 9000]
            flow_type : ['dynamic']
            bidir     : ['yes']
        args    :
            flow_cnt  : 1
            pkt_cnt   : 10

    -   name    : L2_Data_Path_Test
        testcase: testcases.networking.data_path
        enable  : True
        iterators :
            type     : nested
            vnic_type : ['L2']
            nat       : ['no']
            proto     : ['UDP', 'TCP', 'ICMP']
            pyld_size : [4096, 9000]
            flow_type : ['dynamic']
            bidir     : ['yes']
        args    :
            flow_cnt  : 1
            pkt_cnt   : 10

    -   name    : L2_NAT_Data_Path_Test
        testcase: testcases.networking.data_path
        enable  : True
        iterators :
            type     : nested
            vnic_type : ['L2']
            nat       : ['yes']
            proto     : ['UDP', 'TCP', 'ICMP']
            pyld_size : [64, 9000]
            flow_type : ['dynamic']
            bidir     : ['yes']
        args    :
            flow_cnt  : 1
            pkt_cnt   : 10

    #=======================================
    # Connection Tracking Test
    #=======================================

    -   name    : Connection_Tracking_Clear_Flows
        testcase: testcases.networking.aging
        enable  : True
        args    :
            clear_flow_set: True

    -   name    : Flow_Gen_Conntrack
        testcase: testcases.networking.config.flow_gen
        enable  : True
        args    :
            max_dyn_flow_count : 64

    -   name    : Conntrack_Aging_Chkpt_Start
        testcase: testcases.networking.aging
        enable  : True
        args    :
            test_dir: /nic/etc/test_scripts
            test    : conntrack_aging_chkpt_start.txt
            log_file: /var/log/pensando/iota_conntrack_aging_chkpt_start_test.log

    -   name    : Connection_Tracking_Test
        testcase: testcases.networking.conntrack
        enable  : True
        iterators :
            type      : nested
            state     : ['SYNACK_SENT','SYNACK_RECV','ESTABLISHED_H2S', 'ESTABLISHED_S2H','FIN_SENT','FIN_RECV','TIME_WAIT_H2S','TIME_WAIT_S2H','RST_CLOSE_H2S','RST_CLOSE_S2H']
            proto     : ['TCP']

    -   name    : Conntrack_Aging_Chkpt_End
        testcase: testcases.networking.aging
        enable  : True
        args    :
            test_dir: /nic/etc/test_scripts
            test    : conntrack_aging_chkpt_end.txt
            stdout_file: /data/iota_conntrack_chkpt_start.log
            dump_file: /data/iota_conntrack_chkpt_end.log
            dump_sym: flow_state
            dump_expected_count: 0
            log_file: /var/log/pensando/iota_conntrack_aging_chkpt_end_test.log

    #=======================================
    # Aging Tests (without traffic)
    #=======================================

    -   name    : session_aging_hw_large
        testcase: testcases.networking.aging
        enable  : True
        args    :
            test_dir: /nic/etc/test_scripts
            test    : session_aging_hw_large.txt
            log_file: /var/log/pensando/iota_session_large_test.log

    -   name    : conntrack_aging_hw_large
        testcase: testcases.networking.aging
        enable  : True
        args    :
            test_dir: /nic/etc/test_scripts
            test    : conntrack_aging_hw_large.txt
            dump_file: /data/iota_conntrack_large.log
            dump_sym: flow_type
            dump_expected_count: 0
            log_file: /var/log/pensando/iota_conntrack_large_test.log

    -   name    : cache_aging_hw_medium
        testcase: testcases.networking.aging
        enable  : True
        args    :
            test_dir: /nic/etc/test_scripts
            test    : cache_aging_hw_medium.txt
            dump_file: /data/iota_cache_medium.log
            dump_sym: SrcIP
            dump_expected_count: 0
            log_file: /var/log/pensando/iota_cache_medium_test.log

    -   name    : cache_aging_hw_large
        testcase: testcases.networking.aging
        enable  : True
        args    :
            test_dir: /nic/etc/test_scripts
            test    : cache_aging_hw_large.txt
            dump_file: /data/iota_cache_large.log
            dump_sym: SrcIP
            dump_expected_count: 0
            log_file: /var/log/pensando/iota_cache_large_test.log

    -   name    : combined_aging_hw_medium
        testcase: testcases.networking.aging
        enable  : True
        args    :
            test_dir: /nic/etc/test_scripts
            test    : combined_aging_hw_medium.txt
            dump_file: /data/iota_combined_medium.log
            dump_sym: SrcIP
            dump_expected_count: 0
            log_file: /var/log/pensando/iota_combined_medium_test.log

    -   name    : combined_aging_hw_large
        testcase: testcases.networking.aging
        enable  : True
        args    :
            test_dir: /nic/etc/test_scripts
            test    : combined_aging_hw_large.txt
            dump_file: /data/iota_combined_large.log
            dump_sym: SrcIP
            dump_expected_count: 0
            log_file: /var/log/pensando/iota_combined_large_test.log

    -   name    : conntrack_cache_aging_hw_large
        testcase: testcases.networking.aging
        enable  : True
        args    :
            test_dir: /nic/etc/test_scripts
            test    : conntrack_cache_aging_hw_large.txt
            dump_file: /data/iota_conntrack_cache_large.log
            dump_sym: SrcIP
            dump_expected_count: 0
            log_file: /var/log/pensando/iota_conntrack_cache_large_test.log

    #=======================================
    # Aging Tests (with traffic)
    #=======================================

    -   name    : clear_flow_set
        testcase: testcases.networking.aging
        enable  : True
        args    :
            clear_flow_set: True

    -   name    : Flow_Gen_Aging
        testcase: testcases.networking.config.flow_gen
        enable  : True
        args    :
            max_dyn_flow_count : 64

    -   name    : traffic_aging_chkpt_start
        testcase: testcases.networking.aging
        enable  : True
        args    :
            test_dir: /nic/etc/test_scripts
            test    : traffic_aging_chkpt_start.txt
            log_file: /var/log/pensando/iota_traffic_aging_chkpt_start_test.log

    -   name    : Data_Path_Test
        testcase: testcases.networking.data_path
        enable  : True
        ignore  : True
        iterators :
            type     : nested
            vnic_type : ['L3']
            nat       : ['no','yes']
            proto     : ['UDP', 'TCP']
            pyld_size : [64]
            flow_type : ['dynamic']
            bidir     : ['yes']
        args    :
            flow_cnt  : 2
            pkt_cnt   : 1
            skip_flow_hit_check : True

    -   name    : traffic_aging_chkpt_end
        testcase: testcases.networking.aging
        enable  : True
        args    :
            test_dir: /nic/etc/test_scripts
            test    : traffic_aging_chkpt_end.txt
            dump_file: /data/iota_traffic_chkpt_end.log
            dump_sym: SrcIP
            dump_expected_count: 0
            log_file: /var/log/pensando/iota_traffic_aging_chkpt_end_test.log

