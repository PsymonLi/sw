---
version: 2.0
image:
  bind_dir: "/sw"
  work_dir: "/sw/iota/test/standalone"
rebase: true
queue_name: baremetal

# e2e-targets is the scheduler for CI runs to specify baremetal or virtual machine. 
e2e-targets:
  # baremetal + baremetal Esx test cases
 e2e-linux-bm-regression-rdma:
   commands: ["sh", "-c", "make regression-rdma && ./run_iota.sh --testsuite classic --regression --testbundle mtu,rdma_reg"]
   #commands: [ "sh" , "-c", "cat /warmd.json && sleep 30000000"]
   owners: ["email:rdma-dpath@pensando.io"]
   area:
   sub-area:
   feature:
   max-duration: 12h
   build-dependencies:
     - build-iris-arm
     - build-iota
   clusters:
     - image: build-7
       count: 2
       resources:
         # Freebsd works with only server-d
         server-type: server-a
         # nic-type is naples now. In the future, it can be mellanox, or raw, which means no special need
         nic-type: naples
         constraints:
           same-switch: true
   provision:
       username: vm
       password: vm
       vars:
          BmOs: linux
          VmOs: linux
          EsxUsername: root
          EsxPassword: Pen0trl!
 e2e-linux-bm-regression-rdma-stress:
   commands: ["sh", "-c", "make regression-rdma-stress && ./run_iota.sh --testsuite classic --regression --testbundle mtu,rdma_stress"]
   #commands: [ "sh" , "-c", "cat /warmd.json && sleep 30000000"]
   owners: ["email:rdma-dpath@pensando.io"]
   area:
   sub-area:
   feature:
   max-duration: 12h
   build-dependencies:
     - build-iris-arm
     - build-iota
   clusters:
     - image: build-7
       count: 2
       resources:
         # Freebsd works with only server-d
         server-type: server-a
         # nic-type is naples now. In the future, it can be mellanox, or raw, which means no special need
         nic-type: naples
         constraints:
           same-switch: true
   provision:
       username: vm
       password: vm
       vars:
          BmOs: linux
          VmOs: linux
          EsxUsername: root
 
 e2e-linux-bm-regression-eth-RHEL76:
   commands: ["sh", "-c", "make regression-eth && ./run_iota.sh --testsuite classic --regression --testbundle ethtool,connectivity,filters,subifs,rx_mode,mnicclassic,oob1g,ionicdrv,penctl,ionicdrv_regr"]
   #commands: [ "sh" , "-c", "cat /warmd.json && sleep 30000000"]
   owners: ["email:ci-status@pensando.io"]
   area:
   sub-area:
   feature:
   max-duration: 24h
   build-dependencies:
     - build-iris-arm
     - build-iota
   clusters:
     - image: build-9
       count: 2
       resources:
         # Freebsd works with only server-d
         server-type: server-a
         # nic-type is naples now. In the future, it can be mellanox, or raw, which means no special need
         nic-type: naples
   provision:
       username: vm
       password: vm
       vars:
          BmOs: linux
          VmOs: linux
          EsxUsername: root
          EsxPassword: Pen0trl!

 e2e-linux-bm-regression-eth-Ubuntu1804:
   commands: ["sh", "-c", "make regression-eth && ./run_iota.sh --testsuite classic --regression --testbundle ethtool,connectivity,filters,subifs,rx_mode,mnicclassic,oob1g,ionicdrv,penctl,ionicdrv_regr"]
   #commands: [ "sh" , "-c", "cat /warmd.json && sleep 30000000"]
   owners: ["email:ci-status@pensando.io"]
   area:
   sub-area:
   feature:
   max-duration: 24h
   build-dependencies:
     - build-iris-arm
     - build-iota
   clusters:
     - image: build-7
       count: 2
       resources:
         # Freebsd works with only server-d
         server-type: server-a
         # nic-type is naples now. In the future, it can be mellanox, or raw, which means no special need
         nic-type: naples
   provision:
       username: vm
       password: vm
       vars:
          BmOs: linux
          VmOs: linux
          EsxUsername: root
          EsxPassword: Pen0trl!
 
 e2e-linux-bm-regression-storage:
   commands: ["sh", "-c", "make regression-storage && ./run_iota.sh --testsuite classic --regression --testbundle storage"]
   #commands: [ "sh" , "-c", "cat /warmd.json && sleep 30000000"]
   owners: ["email:stg-dev@pensando.io"]
   area:
   sub-area:
   feature:
   max-duration: 12h
   build-dependencies:
     - build-iris-arm
     - build-iota
   clusters:
     - image: build-7
       count: 2
       resources:
         # Freebsd works with only server-d
         server-type: server-a
         # nic-type is naples now. In the future, it can be mellanox, or raw, which means no special need
         nic-type: naples
   provision:
       username: vm
       password: vm
       vars:
          BmOs: linux
          VmOs: linux
          EsxUsername: root
          EsxPassword: Pen0trl!
 e2e-linux-bm-regression-infra:
   commands: ["sh", "-c", "make regression-infra && ./run_iota.sh --testsuite classic --regression --testbundle connectivity,mode_change,post_diag_check,asic_tools,obfl_check"]
   #commands: [ "sh" , "-c", "cat /warmd.json && sleep 30000000"]
   owners: ["email:ci-status@pensando.io"]
   area:
   sub-area:
   feature:
   max-duration: 12h
   build-dependencies:
     - build-iris-arm
     - build-iota
   clusters:
     - image: build-7
       count: 2
       resources:
         # Freebsd works with only server-d
         server-type: server-a
         # nic-type is naples now. In the future, it can be mellanox, or raw, which means no special need
         nic-type: naples
   provision:
       username: vm
       password: vm
       vars:
          BmOs: linux
          VmOs: linux
          EsxUsername: root
          EsxPassword: Pen0trl!

logfiles:
  - /sw/iota/iota_sanity_logs.tar.gz
  - /sw/iota/logs/hostpin_vm/tcdata/COPY_TECH_SUPPORT_1/naples-disruptive-upgrade-tech-support.tar.gz-node1
  - /sw/iota/logs/hostpin_vm/tcdata/COPY_TECH_SUPPORT_1/naples-disruptive-upgrade-tech-support.tar.gz-node2
  - /sw/iota/logs/hostpin_vm/tcdata/COPY_TECH_SUPPORT_1/pre-upgrade-logs.tar.gz-node1
  - /sw/iota/logs/hostpin_vm/tcdata/COPY_TECH_SUPPORT_1/pre-upgrade-logs.tar.gz-node2
