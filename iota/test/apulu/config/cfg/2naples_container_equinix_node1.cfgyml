# Equinix 2node baremetal topology specification
meta:
    id: EQUINIX_HOST_MODE

# 1 Device
# 2 VPCs (1 underlay + 1 Tenant)
# 6 Subnets (as we can have only 6 Host interfaces)
# 6 VNICs
# 6 Local mappings (1 per VNIC)
# 6 Remote mappings
device:
    id                 : 1
    mode               : host
    stack              : ipv4
    bridging           : false
    learn-mode         : auto # none (default), auto, notify
    learn-agetimeout   : 36000
    overlayrouting     : true
    symmetricrouting   : false
    ipaddress          : '17.17.17.17'
    gateway            : '1.0.0.1'
    macaddress         : macaddr/0000.aaaa.aaa1
    encap              : vxlan
    origin             : implicitly-created

uplink:
    - entry:
        id      : uplink0
        port    : 1
        mode    : switch
        status  : UP
        origin  : implicitly-created
    - entry:
        id      : uplink1
        port    : 2
        mode    : switch
        status  : UP
        origin  : implicitly-created

security_profile:
   id          : 1
   origin      : implicitly-created
   deffwaction : deny

vpc:
    - id         : 100
      stack      : ipv4
      count      : 1
      type       : underlay
      origin     : implicitly-created

      interface:
        - iid           : 1
          iftype        : l3
          ifadminstatus : UP
          ipprefix      : '1.1.0.102\24'
          macaddress    : macaddr/00ae.cd00.4fde
          portid        : 1
          encap         : none
          origin        : implicitly-created
        - iid           : 2
          iftype        : l3
          ifadminstatus : UP
          ipprefix      : '1.2.0.102\24'
          macaddress    : macaddr/00ae.cd00.4fdd
          portid        : 2
          encap         : none
          origin        : implicitly-created
        - iid           : 3
          iftype        : loopback
          ifadminstatus : UP
          ipprefix      : '17.17.17.17\32'
          macaddress    : macaddr/0000.0000.0000
          portid        : 0
          encap         : none
          origin        : implicitly-created
          updateneeded  : true

      nexthop:
        - id         : 1
          count      : 1
          type       : underlay
          l3intfid   : 1
          macaddress : macaddr/00ae.cd00.14ce
          origin     : implicitly-created
        - id         : 2
          count      : 1
          type       : underlay
          l3intfid   : 2
          macaddress : macaddr/00ae.cd00.14cd
          origin     : implicitly-created

      bgpglobal:
        - localasn      : 100
          routerid      : 17.17.17.17

      bgppeer:
        # if interface is specified, ip addresses are overriden from
        # testbed json
        - peeraddr      : 17.1.0.2  # underlay bgp peer 1
          localaddr     : 17.1.0.1
          # specify interface to override ip addresses from testbed json
          interface     : "Uplink0"
          remoteasn     : 600
          holdtime      : 180
          keepalive     : 60
          bgppeeraf:
              afi       : ipv4
              safi      : unicast
        - peeraddr      : 17.2.0.2  # underlay bgp peer 2
          localaddr     : 17.2.0.1
          # specify interface to override ip addresses from testbed json
          interface     : "Uplink1"
          remoteasn     : 600
          holdtime      : 180
          keepalive     : 60
          bgppeeraf:
              afi       : ipv4
              safi      : unicast
        - peeraddr      : 50.50.50.1  # overlay bgp peer 1
          localaddr     : 17.17.17.17
          # specify interface to override ip addresses from testbed json
          interface     : "Loopback0"
          remoteasn     : 100
          holdtime      : 180
          keepalive     : 60
          bgppeeraf:
              afi       : l2vpn
              safi      : evpn

    - stack : ipv4
      count : 1
      type  : tenant
      v4prefix : '2.0.0.0\24'

      tunnel:
        - id         : 1
          count      : 1
          type       : underlay
          srcaddr    : '1.0.0.2'
          dstaddr    : '1.0.0.3'
          macaddress : macaddr/0000.aaaa.aaa1
          encap      : vxlan
          nhid       : 1

      subnet:
        - id               : 1
          count            : 1
          v4prefix         : '10.1.0.0\24'
          v4prefixlen      : 24
          fabricencap:
            type  : vxlan
          v4ingrpolicycount: 1
          v4egrpolicycount : 1
          v6ingrpolicycount: 1
          v6egrpolicycount : 1

          vnic:
            - count     : 1             # 1 untagged VNIC
              vmac      : usepfmac      # use the mac from the associated PF
              srcguard  : false         # true or false (default false)
              public    : false
              vnicencap:
                type: none
              origin    : discovered
              remoteroutes :
                    - '10.0.0.0\8'
              ipcount      : 1
              dhcpenabled  : true

        - id               : 2
          count            : 1
          v4prefix         : '10.2.0.0\24'
          v4prefixlen      : 24
          fabricencap:
            type : vxlan
          v4ingrpolicycount: 1
          v4egrpolicycount : 1
          v6ingrpolicycount: 1
          v6egrpolicycount : 1

          vnic:
            - count     : 1             # 1 untagged VNIC
              vmac      : usepfmac
              srcguard  : false         # true or false (default false)
              public    : false
              vnicencap:
                type: none
              origin    : discovered
              remoteroutes :
                    - '10.0.0.0\8'
              ipcount      : 1
              dhcpenabled  : true

        - id               : 3
          count            : 1
          v4prefix         : '10.3.0.0\24'
          v4prefixlen      : 24
          fabricencap:
            type : vxlan
          v4ingrpolicycount: 1
          v4egrpolicycount : 1
          v6ingrpolicycount: 1
          v6egrpolicycount : 1

          vnic:
            - count     : 1             # 1 untagged VNIC
              vmac      : usepfmac
              srcguard  : false         # true or false (default false)
              public    : false
              vnicencap:
                type: none
              origin    : discovered
              remoteroutes :
                    - '10.0.0.0\8'
              ipcount      : 1
              dhcpenabled  : true

        - id               : 4
          count            : 1
          v4prefix         : '10.4.0.0\24'
          v4prefixlen      : 24
          fabricencap:
            type : vxlan
          v4ingrpolicycount: 1
          v4egrpolicycount : 1
          v6ingrpolicycount: 1
          v6egrpolicycount : 1

          vnic:
            - count     : 1             # 1 untagged VNIC
              vmac      : usepfmac
              srcguard  : false         # true or false (default false)
              public    : false
              vnicencap:
                type: none
              origin    : discovered
              remoteroutes :
                    - '10.0.0.0\8'
              ipcount      : 32

        - id               : 5
          count            : 1
          v4prefix         : '10.5.0.0\24'
          v4prefixlen      : 24
          fabricencap:
            type : vxlan
          v4ingrpolicycount: 1
          v4egrpolicycount : 1
          v6ingrpolicycount: 1
          v6egrpolicycount : 1

          vnic:
            - count     : 1             # 1 untagged VNIC
              vmac      : usepfmac
              srcguard  : false         # true or false (default false)
              public    : false
              vnicencap:
                type: none
              origin    : discovered
              remoteroutes :
                    - '10.0.0.0\8'
              ipcount      : 32

        - id               : 6
          count            : 1
          v4prefix         : '10.6.0.0\24'
          v4prefixlen      : 24
          fabricencap:
            type : vxlan
          v4ingrpolicycount: 1
          v4egrpolicycount : 1
          v6ingrpolicycount: 1
          v6egrpolicycount : 1

          vnic:
            - count     : 1             # 1 untagged VNIC
              vmac      : usepfmac
              srcguard  : false         # true or false (default false)
              public    : false
              vnicencap:
                type: none
              origin    : discovered
              remoteroutes :
                    - '10.0.0.0\8'
              ipcount      : 32


      nexthop:
        - id         : 3
          type       : overlay
          count      : 1
          tunnelid   : 1
          origin     : discovered

      routetbl:
        - type      : specific
          origin    : fixed
          count     : 1
          routetype : disjoint
          teptype   : underlay
          v4routes  :
            - '10.10.0.0\16'

      policy:
        - type       : specific
          policytype : default
          direction  : bidir
