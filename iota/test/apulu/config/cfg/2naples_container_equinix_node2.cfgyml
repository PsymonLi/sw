# Equinix 2node baremetal topology specification
meta:
    id: EQUINIX_HOST_MODE

# 1 Device
# 2 VPCs (1 underlay + 1 Tenant)
# 6 Subnets (as we can have only 6 Host interfaces)
# 6 VNICs
# 6 Local mappings (1 per VNIC)
# 6 Remote mappings
device:
    id          : 1
    mode        : host
    stack       : ipv4
    bridging    : false
    learning    : true
    overlay     : false
    ipaddress   : '18.18.18.18'
    gateway     : '1.0.0.1'
    macaddress  : macaddr/0000.bbbb.bbb1
    encap       : vxlan
    origin      : implicitly-created
    learningagetimeout : 36000

uplink:
    - entry:
        id      : uplink0
        port    : 1
        mode    : switch
        status  : UP
        origin  : implicitly-created
    - entry:
        id      : uplink1
        port    : 2
        mode    : switch
        status  : UP
        origin  : implicitly-created

vpc:
    - id         : 100
      stack      : ipv4
      count      : 1
      type       : underlay
      origin     : implicitly-created

      interface:
        - iid           : 1
          iftype        : l3
          ifadminstatus : UP
          ipprefix      : '1.1.0.103\24'
          macaddress    : macaddr/00ae.cd00.14ce
          portid        : 1
          encap         : none
          origin        : implicitly-created
        - iid           : 2
          iftype        : l3
          ifadminstatus : UP
          ipprefix      : '1.2.0.103\24'
          macaddress    : macaddr/00ae.cd00.14cd
          portid        : 2
          encap         : none
          origin        : implicitly-created
        - iid           : 3
          iftype        : loopback
          ifadminstatus : UP
          ipprefix      : '18.18.18.18\32'
          macaddress    : macaddr/0000.0000.0000
          portid        : 0
          encap         : none
          origin        : implicitly-created
          updateneeded  : true

      nexthop:
        - id         : 1
          count      : 1
          type       : underlay
          l3intfid   : 1
          macaddress : macaddr/00ae.cd00.4fde
          origin     : implicitly-created
        - id         : 2
          count      : 1
          type       : underlay
          l3intfid   : 2
          macaddress : macaddr/00ae.cd00.4fdd
          origin     : implicitly-created

      bgpglobal:
        - localasn      : 100
          routerid      : 18.18.18.18

      bgppeer:
        # if interface is specified, ip addresses are overriden from
        # testbed json
        - peeraddr      : 18.1.0.2  # underlay bgp peer 1
          localaddr     : 18.1.0.1
          # specify interface to override ip addresses from testbed json
          interface     : "Uplink0"
          remoteasn     : 600
          holdtime      : 180
          keepalive     : 60
          bgppeeraf:
              afi       : ipv4
              safi      : unicast
        - peeraddr      : 18.2.0.2  # underlay bgp peer 2
          localaddr     : 18.2.0.1
          # specify interface to override ip addresses from testbed json
          interface     : "Uplink1"
          remoteasn     : 600
          holdtime      : 180
          keepalive     : 60
          bgppeeraf:
              afi       : ipv4
              safi      : unicast
        - peeraddr      : 50.50.50.1  # overlay bgp peer 1
          localaddr     : 18.18.18.18
          # specify interface to override ip addresses from testbed json
          interface     : "Loopback0"
          remoteasn     : 100
          holdtime      : 180
          keepalive     : 60
          bgppeeraf:
              afi       : l2vpn
              safi      : evpn

    - id         : 1
      stack      : ipv4
      count      : 1
      type       : tenant
      v4prefix   : '2.0.0.0\24'

      tunnel:
        - id         : 1
          count      : 1
          type       : underlay
          srcaddr    : '1.0.0.3'
          dstaddr    : '1.0.0.2'
          macaddress : macaddr/0000.bbbb.bbb1
          encap      : vxlan
          nhid       : 1

      subnet:
        - id               : 1
          count            : 1
          v4prefix         : '10.1.0.0\24'
          v4prefixlen      : 24
          fabricencap      : vxlan
          evpnevi:
            - rttype : import_export
              autort : manual
              autord : auto
              encap  : vxlan
          evpnevirt:
            - rttype : import_export
              rt     : 00:02:00:01:10:00:00:64
            - rttype : import_export
              rt     : 00:02:00:01:10:00:00:65

          vnic:
            - count     : 1             # 1 untagged VNIC
              vmac      : usepfmac
              srcguard  : false         # true or false (default false)
              public    : false
              tagged    : false         # true or false (default true)
              origin    : discovered
              remoteroutes :
                    - '10.0.0.0\8'
              ipcount      : 1
              dhcpenabled  : true

        - id               : 2
          count            : 1
          v4prefix         : '10.2.0.0\24'
          v4prefixlen      : 24
          fabricencap      : vxlan
          evpnevi:
            - rttype : import_export
              autort : manual
              autord : auto
              encap  : vxlan
          evpnevirt:
            - rttype : import_export
              rt     : 00:02:00:01:10:00:00:64
            - rttype : import_export
              rt     : 00:02:00:01:10:00:00:65

          vnic:
            - count     : 1             # 1 untagged VNIC
              vmac      : usepfmac
              srcguard  : false         # true or false (default false)
              public    : false
              tagged    : false         # true or false (default true)
              origin    : discovered
              remoteroutes :
                    - '10.0.0.0\8'
              ipcount      : 1
              dhcpenabled  : true

        - id               : 3
          count            : 1
          v4prefix         : '10.3.0.0\24'
          v4prefixlen      : 24
          fabricencap      : vxlan
          evpnevi:
            - rttype : import_export
              autort : manual
              autord : auto
              encap  : vxlan
          evpnevirt:
            - rttype : import_export
              rt     : 00:02:00:01:10:00:00:64
            - rttype : import_export
              rt     : 00:02:00:01:10:00:00:65

          vnic:
            - count     : 1             # 1 untagged VNIC
              vmac      : usepfmac
              srcguard  : false         # true or false (default false)
              public    : false
              tagged    : false         # true or false (default true)
              origin    : discovered
              remoteroutes :
                    - '10.0.0.0\8'
              ipcount      : 1
              dhcpenabled  : true

        - id               : 4
          count            : 1
          v4prefix         : '10.4.0.0\24'
          v4prefixlen      : 24
          fabricencap      : vxlan
          evpnevi:
            - rttype : import_export
              autort : manual
              autord : auto
              encap  : vxlan
          evpnevirt:
            - rttype : import_export
              rt     : 00:02:00:01:10:00:00:64
            - rttype : import_export
              rt     : 00:02:00:01:10:00:00:65

          vnic:
            - count     : 1             # 1 untagged VNIC
              vmac      : usepfmac
              srcguard  : false         # true or false (default false)
              public    : false
              tagged    : false         # true or false (default true)
              origin    : discovered
              remoteroutes :
                    - '10.0.0.0\8'
              ipcount      : 1

        - id               : 5
          count            : 1
          v4prefix         : '10.5.0.0\24'
          v4prefixlen      : 24
          fabricencap      : vxlan
          evpnevi:
            - rttype : import_export
              autort : manual
              autord : auto
              encap  : vxlan
          evpnevirt:
            - rttype : import_export
              rt     : 00:02:00:01:10:00:00:64
            - rttype : import_export
              rt     : 00:02:00:01:10:00:00:65

          vnic:
            - count     : 1             # 1 untagged VNIC
              vmac      : usepfmac
              srcguard  : false         # true or false (default false)
              public    : false
              tagged    : false         # true or false (default true)
              origin    : discovered
              remoteroutes :
                    - '10.0.0.0\8'
              ipcount      : 1

        - id               : 6
          count            : 1
          v4prefix         : '10.6.0.0\24'
          v4prefixlen      : 24
          fabricencap      : vxlan
          evpnevi:
            - rttype : import_export
              autort : manual
              autord : auto
              encap  : vxlan
          evpnevirt:
            - rttype : import_export
              rt     : 00:02:00:01:10:00:00:64
            - rttype : import_export
              rt     : 00:02:00:01:10:00:00:65

          vnic:
            - count     : 1             # 1 untagged VNIC
              vmac      : usepfmac
              srcguard  : false         # true or false (default false)
              public    : false
              tagged    : false         # true or false (default true)
              origin    : discovered
              remoteroutes :
                    - '10.0.0.0\8'
              ipcount      : 1

      nexthop:
        - id         : 3
          type       : overlay
          count      : 1
          tunnelid   : 1
          origin     : discovered

      routetbl:
        - type      : specific
          count     : 1
          routetype : disjoint
          teptype   : underlay
          v4routes  :
            - '10.10.0.0\16'
            - '50.5.0.0\16'

      policy:
        - type       : specific
          policytype : default
          direction  : bidir
