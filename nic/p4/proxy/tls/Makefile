
TOPDIR = ../../..
CUSTOM = my_all
include $(TOPDIR)/make/Makefile.inc

NCC = ../../../tools/ncc/capri-ncc.py
OBJ_DIR = ../../../obj
GEN_DIR = ../../../gen
NCC_OPTIONS = --p4-plus --pd-gen --asm-out --no-ohi --two-byte-profile
#TLS_PROJ = proxy
TLS_TX_PRE_CRYPTO_ENC_PROJ = tls_txdma_pre_crypto_enc
TLS_TX_PRE_CRYPTO_ENC_GEN_FILE = $(GEN_DIR)/$(TLS_TX_PRE_CRYPTO_ENC_PROJ)/asm_out/ingress.h
TLS_TX_PRE_CRYPTO_DEC_PROJ = tls_txdma_pre_crypto_dec
TLS_TX_PRE_CRYPTO_DEC_GEN_FILE = $(GEN_DIR)/$(TLS_TX_PRE_CRYPTO_DEC_PROJ)/asm_out/ingress.h
TLS_TX_PRE_CRYPTO_MAC_PROJ = tls_txdma_pre_crypto_mac
TLS_TX_PRE_CRYPTO_MAC_GEN_FILE = $(GEN_DIR)/$(TLS_TX_PRE_CRYPTO_MAC_PROJ)/asm_out/ingress.h
TLS_TX_POST_CRYPTO_ENC_PROJ = tls_txdma_post_crypto_enc
TLS_TX_POST_CRYPTO_ENC_GEN_FILE = $(GEN_DIR)/$(TLS_TX_POST_CRYPTO_ENC_PROJ)/asm_out/ingress.h
TLS_TX_POST_CRYPTO_DEC_PROJ = tls_txdma_post_crypto_dec
TLS_TX_POST_CRYPTO_DEC_GEN_FILE = $(GEN_DIR)/$(TLS_TX_POST_CRYPTO_DEC_PROJ)/asm_out/ingress.h
TLS_TX_PRE_CRYPTO_DEC_AESGCM_NEWSEG_PROJ = tls_txdma_pre_crypto_dec_aesgcm_newseg
TLS_TX_PRE_CRYPTO_DEC_AESGCM_NEWSEG_GEN_FILE = $(GEN_DIR)/$(TLS_TX_PRE_CRYPTO_DEC_AESGCM_NEWSEG_PROJ)/asm_out/ingress.h
TLS_TX_POST_CRYPTO_DEC_AESGCM_NEWSEG_PROJ = tls_txdma_post_crypto_dec_aesgcm_newseg
TLS_TX_POST_CRYPTO_DEC_AESGCM_NEWSEG_GEN_FILE = $(GEN_DIR)/$(TLS_TX_POST_CRYPTO_DEC_AESGCM_NEWSEG_PROJ)/asm_out/ingress.h
TLS_TX_POST_CRYPTO_MAC_PROJ = tls_txdma_post_crypto_mac
TLS_TX_POST_CRYPTO_MAC_GEN_FILE = $(GEN_DIR)/$(TLS_TX_POST_CRYPTO_MAC_PROJ)/asm_out/ingress.h

TLS_TXDMA_DEPS = tls_txdma_common.p4

my_all: $(TLS_TX_PRE_CRYPTO_ENC_GEN_FILE) $(TLS_TX_PRE_CRYPTO_DEC_GEN_FILE) \
		$(TLS_TX_POST_CRYPTO_ENC_GEN_FILE) $(TLS_TX_POST_CRYPTO_DEC_GEN_FILE) \
		$(TLS_TX_PRE_CRYPTO_MAC_GEN_FILE) $(TLS_TX_POST_CRYPTO_MAC_GEN_FILE) \
		$(TLS_TX_PRE_CRYPTO_DEC_AESGCM_NEWSEG_GEN_FILE) \
		$(TLS_TX_POST_CRYPTO_DEC_AESGCM_NEWSEG_GEN_FILE)

$(TLS_TX_PRE_CRYPTO_ENC_GEN_FILE): $(TLS_TX_PRE_CRYPTO_ENC_PROJ).p4 $(TLS_TXDMA_DEPS)
	$(NCC) $(NCC_OPTIONS) $(TLS_TX_PRE_CRYPTO_ENC_PROJ).p4 --gen-dir $(GEN_DIR)

$(TLS_TX_PRE_CRYPTO_DEC_GEN_FILE): $(TLS_TX_PRE_CRYPTO_DEC_PROJ).p4 $(TLS_TXDMA_DEPS)
	$(NCC) $(NCC_OPTIONS) $(TLS_TX_PRE_CRYPTO_DEC_PROJ).p4 --gen-dir $(GEN_DIR)

$(TLS_TX_PRE_CRYPTO_MAC_GEN_FILE): $(TLS_TX_PRE_CRYPTO_MAC_PROJ).p4 $(TLS_TXDMA_DEPS)
	$(NCC) $(NCC_OPTIONS) $(TLS_TX_PRE_CRYPTO_MAC_PROJ).p4 --gen-dir $(GEN_DIR)

$(TLS_TX_POST_CRYPTO_ENC_GEN_FILE): $(TLS_TX_POST_CRYPTO_ENC_PROJ).p4 $(TLS_TXDMA_DEPS)
	$(NCC) $(NCC_OPTIONS) $(TLS_TX_POST_CRYPTO_ENC_PROJ).p4 --gen-dir $(GEN_DIR)

$(TLS_TX_POST_CRYPTO_DEC_GEN_FILE): $(TLS_TX_POST_CRYPTO_DEC_PROJ).p4 $(TLS_TXDMA_DEPS)
	$(NCC) $(NCC_OPTIONS) $(TLS_TX_POST_CRYPTO_DEC_PROJ).p4 --gen-dir $(GEN_DIR)

$(TLS_TX_PRE_CRYPTO_DEC_AESGCM_NEWSEG_GEN_FILE): $(TLS_TX_PRE_CRYPTO_DEC_AESGCM_NEWSEG_PROJ).p4 $(TLS_TXDMA_DEPS)
	$(NCC) $(NCC_OPTIONS) $(TLS_TX_PRE_CRYPTO_DEC_AESGCM_NEWSEG_PROJ).p4 --gen-dir $(GEN_DIR)

$(TLS_TX_POST_CRYPTO_DEC_AESGCM_NEWSEG_GEN_FILE): $(TLS_TX_POST_CRYPTO_DEC_AESGCM_NEWSEG_PROJ).p4 $(TLS_TXDMA_DEPS)
	$(NCC) $(NCC_OPTIONS) $(TLS_TX_POST_CRYPTO_DEC_AESGCM_NEWSEG_PROJ).p4 --gen-dir $(GEN_DIR)

$(TLS_TX_POST_CRYPTO_MAC_GEN_FILE): $(TLS_TX_POST_CRYPTO_MAC_PROJ).p4 $(TLS_TXDMA_DEPS)
	$(NCC) $(NCC_OPTIONS) $(TLS_TX_POST_CRYPTO_MAC_PROJ).p4 --gen-dir $(GEN_DIR)

clean:
	rm -rf $(GEN_DIR)/$(TLS_TX_PRE_CRYPTO_ENC_PROJ)
	rm -rf $(GEN_DIR)/$(TLS_TX_PRE_CRYPTO_DEC_PROJ)
	rm -rf $(GEN_DIR)/$(TLS_TX_PRE_CRYPTO_MAC_PROJ)
	rm -rf $(GEN_DIR)/$(TLS_TX_POST_CRYPTO_ENC_PROJ)
	rm -rf $(GEN_DIR)/$(TLS_TX_POST_CRYPTO_DEC_PROJ)
	rm -rf $(GEN_DIR)/$(TLS_TX_PRE_CRYPTO_DEC_AESGCM_NEWSEG_PROJ)
	rm -rf $(GEN_DIR)/$(TLS_TX_POST_CRYPTO_DEC_AESGCM_NEWSEG_PROJ)
	rm -rf $(GEN_DIR)/$(TLS_TX_POST_CRYPTO_MAC_PROJ)
