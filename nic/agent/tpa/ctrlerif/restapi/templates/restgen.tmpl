// Code generated by protoc-gen-grpc-pensando DO NOT EDIT.

/*
 * Package restapi is a auto generated package.
 * Input file: {{.Name}}
 */
package restapi
import (
    "github.com/gorilla/mux"
    tpmprotos "github.com/pensando/sw/venice/ctrler/tpm/rpcserver/protos"
)

{{range .Services}}
    {{$svcname := .Name}}
    {{if (hasExtension "venice.naplesRestService" .)}}
       {{$params := (getRestSvcOptions .)}}
       {{range $params}}
            // add{{.CrudObject}}APIRoutes adds {{.CrudObject}}
            func add{{.CrudObject}}APIRoutes(r *mux.Router, srv *RestServer){
            {{$crudObject := .CrudObject}}
            {{$pattern := .Pattern}}
            {{$methods := .Methods}}
            {{range $methods}}
                {{if strEq . "list"}}
                    r.Methods("GET").Subrouter().HandleFunc("/", httputils.MakeHTTPHandler(srv.FlowExportPolicy{{title .}}Handler))
                {{else if strEq . "post"}}
                    r.Methods("{{upper .}}").Subrouter().HandleFunc("/", httputils.MakeHTTPHandler(srv.FlowExportPolicy{{title .}}Handler))
                {{else}}
                    r.Methods("{{upper .}}").Subrouter().HandleFunc("{{$pattern}}", httputils.MakeHTTPHandler(srv.FlowExportPolicy{{title .}}Handler))
                {{end}}
            {{end}}
            }
       {{end}}
       {{range $params}}
           {{$crudObject := .CrudObject}}
           {{$pattern := .Pattern}}
           {{$methods := .Methods}}
           {{range $methods}}
                {{if strEq . "list"}}
                    func (s *RestServer) FlowExportPolicy{{title .}}Handler(r *http.Request) (interface{}, error){
                        res, err :=  s.TpAgent.ListFlowExportPolicy(r.Context())
                        if err != nil {
                           return MakeErrorResponse(http.StatusInternalServerError, err)
                        }
                        return res, err
                    }
                {{else}}
                    func (s *RestServer) FlowExportPolicy{{title .}}Handler(r *http.Request) (interface{}, error){
                        var o tpmprotos.{{title $crudObject}}

                        {{if strEq . "get"}}
                             o.TypeMeta.Kind = "FlowExportPolicy"
                             o.ObjectMeta.Tenant = mux.Vars(r)["ObjectMeta.Tenant"]
                             o.ObjectMeta.Namespace = mux.Vars(r)["ObjectMeta.Namespace"]
                             o.ObjectMeta.Name = mux.Vars(r)["ObjectMeta.Name"]
                             res, err := s.TpAgent.GetFlowExportPolicy(r.Context(),&o)
                             if err != nil {
                                return MakeErrorResponse(http.StatusInternalServerError, err)
                             }
                             return res, err

                        {{else if strEq . "delete"}}
                             o.TypeMeta.Kind = "FlowExportPolicy"
                             o.ObjectMeta.Tenant = mux.Vars(r)["ObjectMeta.Tenant"]
                             o.ObjectMeta.Namespace = mux.Vars(r)["ObjectMeta.Namespace"]
                             o.ObjectMeta.Name = mux.Vars(r)["ObjectMeta.Name"]

                             err := s.TpAgent.DeleteFlowExportPolicy(r.Context(), &o)
                             if err != nil {
                                return MakeErrorResponse(http.StatusInternalServerError, err)
                             }
                             return &Response{}, err

                        {{else if strEq . "post"}}
                             b, _ := ioutil.ReadAll(r.Body)
                             err := json.Unmarshal(b, &o)
                             if err != nil {
                                 return MakeErrorResponse(http.StatusInternalServerError, err)
                             }
                             c, _ := types.TimestampProto(time.Now())
                             o.CreationTime = api.Timestamp{
                                Timestamp: *c,
                             }
                             o.ModTime = api.Timestamp{
                                Timestamp: *c,
                             }
                             err = s.TpAgent.CreateFlowExportPolicy(r.Context(), &o)
                             if err != nil {
                                 return MakeErrorResponse(http.StatusInternalServerError, err)
                             }
                             res := &Response{}
                             res.References = []string{fmt.Sprintf("%s%s/%s/%s",r.RequestURI, o.Tenant, o.Namespace, o.Name)}
                             res.StatusCode = http.StatusOK
                             return res, err

                        {{else if strEq . "put"}}
                             b, _ := ioutil.ReadAll(r.Body)
                             err := json.Unmarshal(b, &o)
                             if err != nil {
                                return MakeErrorResponse(http.StatusInternalServerError, err)
                             }
                             m, _ := types.TimestampProto(time.Now())
                             o.ModTime = api.Timestamp{
                                Timestamp: *m,
                             }
                             err = s.TpAgent.UpdateFlowExportPolicy(r.Context(), &o)
                             if err != nil {
                                 return MakeErrorResponse(http.StatusInternalServerError, err)
                             }
                             res := &Response{}
                             res.References = []string{fmt.Sprintf("%s%s/%s/%s",r.RequestURI, o.Tenant, o.Namespace, o.Name)}
                             res.StatusCode = http.StatusOK
                             return &res, err
                        {{end}}
                    }
                {{end}}
           {{end}}
       {{end}}
    {{end}}
{{end}}
