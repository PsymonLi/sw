#!/bin/sh

if ! [ -x "$(command -v locale)" ]; then
  echo 'Error: locale is not installed. Please follow the p4ctl README ' >&2
  exit 1
fi
repl=1
pipeline=
while getopts ":c:p:h" opt; do
  case ${opt} in
    c )
      cmd=$OPTARG
      repl=0
      #echo $cmd
      #echo $repl
      ;;
    p )
      pipeline=$OPTARG
      if [ $pipeline != "iris" ] && [ $pipeline != "apollo" ] && [ $pipeline != "apulu" ] && [ $pipeline != "artemis" ]; then
        echo -e "-p <pipeline can be iris or apollo or artemis> \n Usage: p4ctl -p <iris|apollo|artemis|apulu> -c \"debug ...\""
        exit
      fi
      ;;
    h )
      echo "Usage: p4ctl -p <iris|apollo|artemis|apulu> -c \"debug ...\""
      exit
      ;;
    \? )
      echo "Usage: p4ctl -p <iris|apollo|artemis|apulu> -c \"debug ...\""
      exit
      ;;
    : )
      echo "Usage: p4ctl -p <iris|apollo|artemis|apulu> -c \"debug ...\""
      exit
      ;;
  esac
done
shift $((OPTIND -1))
if [ -z "$pipeline" ]; then
   echo -e " -p <pipeline is mandatory> \n Usage:  p4ctl -p <iris|apollo|artemis|apulu> -c \"debug ...\""
   exit
fi

localedef -i en_US -f UTF-8 en_US.UTF-8
export LC_ALL="en_US.UTF-8"
export LANG="en_US.UTF-8"
export LD_LIBRARY_PATH=/nic/lib:/nic/cli
export HAL_CONFIG_PATH=/nic/conf
export ASIC_SLAVE_INIT=1
if [[ "$repl" -eq 0 ]]; then
        echo "python3 /nic/cli/debug_cli_$pipeline.py cmd"
        python3 /nic/cli/debug_cli_$pipeline.py $cmd
else
        #echo "python3 /nic/cli/debug_cli_$pipeline.py repl"
        python3 /nic/cli/debug_cli_$pipeline.py repl
fi
