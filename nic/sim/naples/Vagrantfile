# -*- mode: ruby -*-
# vi: set ft=ruby :

BOX_IMAGE = "centos/7"
NODE_COUNT = 2

NAPLES_IMAGE = "centos"

Vagrant.configure("2") do |config|
  config.vm.box = BOX_IMAGE

  NODE_COUNT.times do |i|
    config.vm.define "node#{i+1}" do |subconfig|
      subconfig.vm.hostname = "node#{i+1}"
      subconfig.vm.network :private_network, auto_config: false,
                           ip: "10.0.0.#{i+11}" # ip not used (just to make vagrant happy)
    end
  end
  
  config.vm.provider "virtualbox" do |vb|
     vb.memory = "2096"
     vb.cpus = 4
  end

  # bringup naples container
  config.vm.provision "docker" do |d|
    d.run "naples-sim", image: NAPLES_IMAGE, cmd: "tail -f /dev/null", args: "--privileged"
  end

  #one time setup
  config.vm.provision "shell", inline: "yum install -y bridge-utils tcpdump"

  # Run this on every boot
  config.vm.provision "shell", path: "bootstrap.sh", run: 'always'
  
end
