//------------------------------------------------------------------------------
// {C} Copyright 2017 Pensando Systems Inc. All rights reserved
//
// protobuf specification for system level information.
//  - Status
//  - Stats
//      - Drop Stats
//      - Table Stats
//      - Proxy Stats
//------------------------------------------------------------------------------

syntax = "proto3";

import "types.proto";
import "qos.proto";
option go_package="halproto";

package sys;

// System service definition
service System {
  // System related APIs
  rpc ApiStatsGet(types.Empty) returns (ApiStatsResponse) {}
  rpc SystemGet(types.Empty) returns (SystemResponse) {}
}

enum ApiCounter {
  API_COUNTER_NONE                                      = 0;
  API_COUNTER_VRF_CREATE                                = 1;
  API_COUNTER_VRF_UPDATE                                = 2;
  API_COUNTER_VRF_DELETE                                = 3;
  API_COUNTER_VRF_GET                                   = 4;
  API_COUNTER_ACL_CREATE                                = 5;
  API_COUNTER_ACL_UPDATE                                = 6;
  API_COUNTER_ACL_DELETE                                = 7;
  API_COUNTER_ACL_GET                                   = 8;
  API_COUNTER_CPUCB_CREATE                              = 9;
  API_COUNTER_CPUCB_UPDATE                              = 10;
  API_COUNTER_CPUCB_DELETE                              = 11;
  API_COUNTER_CPUCB_GET                                 = 12;
  API_COUNTER_CRYPTOAPI_INVOKE                          = 13;
  API_COUNTER_CRYPTOKEY_CREATE                          = 14;
  API_COUNTER_CRYPTOKEY_UPDATE                          = 15;
  API_COUNTER_CRYPTOKEY_DELETE                          = 16;
  API_COUNTER_CRYPTOKEY_READ                            = 17;
  API_COUNTER_DESCRAOL_GET                              = 18;
  API_COUNTER_ENDPOINT_CREATE                           = 19;
  API_COUNTER_ENDPOINT_UPDATE                           = 20;
  API_COUNTER_ENDPOINT_DELETE                           = 21;
  API_COUNTER_ENDPOINT_GET                              = 22;
  API_COUNTER_GFT_EXACT_MATCH_PROFILE_CREATE            = 23;
  API_COUNTER_GFT_HEADER_TRANSPOSITION_PROFILE_CREATE   = 24;
  API_COUNTER_GFT_EXACT_MATCH_FLOW_ENTRY_CREATE         = 25;
  API_COUNTER_GETPROGRAM_ADDRESS                        = 26;
  API_COUNTER_ALLOCHBM_ADDRESS                          = 27;
  API_COUNTER_CONFIGURELIF_BDF                          = 28;
  API_COUNTER_IPSECCB_CREATE                            = 29;
  API_COUNTER_IPSECCB_UPDATE                            = 30;
  API_COUNTER_IPSECCB_DELETE                            = 31;
  API_COUNTER_IPSECCB_GET                               = 32;
  API_COUNTER_L2SEGMENT_CREATE                          = 33;
  API_COUNTER_L2SEGMENT_UPDATE                          = 34;
  API_COUNTER_L2SEGMENT_DELETE                          = 35;
  API_COUNTER_L2SEGMENT_GET                             = 36;
  API_COUNTER_L4LBSERVICE_CREATE                        = 37;
  API_COUNTER_MULTICASTENTRY_CREATE                     = 38;
  API_COUNTER_MULTICASTENTRY_UPDATE                     = 39;
  API_COUNTER_MULTICASTENTRY_DELETE                     = 40;
  API_COUNTER_MULTICASTENTRY_GET                        = 41;
  API_COUNTER_SECURITYPROFILE_CREATE                    = 42;
  API_COUNTER_SECURITYPROFILE_UPDATE                    = 43;
  API_COUNTER_SECURITYPROFILE_DELETE                    = 44;
  API_COUNTER_SECURITYPROFILE_GET                       = 45;
  API_COUNTER_SECURITYGROUPPOLICY_CREATE                = 46;
  API_COUNTER_SECURITYGROUPPOLICY_UPDATE                = 47;
  API_COUNTER_SECURITYGROUPPOLICY_DELETE                = 48;
  API_COUNTER_SECURITYGROUPPOLICY_GET                   = 49;
  API_COUNTER_SECURITYGROUP_CREATE                      = 50;
  API_COUNTER_SECURITYGROUP_UPDATE                      = 51;
  API_COUNTER_SECURITYGROUP_DELETE                      = 52;
  API_COUNTER_SECURITYGROUP_GET                         = 53;
  API_COUNTER_DOSPOLICY_CREATE                          = 54;
  API_COUNTER_DOSPOLICY_UPDATE                          = 55;
  API_COUNTER_DOSPOLICY_DELETE                          = 56;
  API_COUNTER_DOSPOLICY_GET                             = 57;
  API_COUNTER_PROXYCCB_CREATE                           = 58;
  API_COUNTER_PROXYCCB_UPDATE                           = 59;
  API_COUNTER_PROXYCCB_DELETE                           = 60;
  API_COUNTER_PROXYCCB_GET                              = 61;
  API_COUNTER_PROXYRCB_CREATE                           = 62;
  API_COUNTER_PROXYRCB_UPDATE                           = 63;
  API_COUNTER_PROXYRCB_DELETE                           = 64;
  API_COUNTER_PROXYRCB_GET                              = 65;
  API_COUNTER_QOSCLASS_CREATE                           = 66;
  API_COUNTER_QOSCLASS_UPDATE                           = 67;
  API_COUNTER_QOSCLASS_DELETE                           = 68;
  API_COUNTER_QOSCLASS_GET                              = 69;
  API_COUNTER_COPP_UPDATE                               = 70;
  API_COUNTER_COPP_GET                                  = 71;
  API_COUNTER_RAWCCB_CREATE                             = 72;
  API_COUNTER_RAWCCB_UPDATE                             = 73;
  API_COUNTER_RAWCCB_DELETE                             = 74;
  API_COUNTER_RAWCCB_GET                                = 75;
  API_COUNTER_TCPCB_CREATE                              = 76;
  API_COUNTER_TCPCB_UPDATE                              = 77;
  API_COUNTER_TCPCB_DELETE                              = 78;
  API_COUNTER_TCPCB_GET                                 = 79;
  API_COUNTER_TLSCB_CREATE                              = 80;
  API_COUNTER_TLSCB_UPDATE                              = 81;
  API_COUNTER_TLSCB_DELETE                              = 82;
  API_COUNTER_TLSCB_GET                                 = 83;
  API_COUNTER_MAX                                       = 84;
}

message ApiStatsEntry {
  ApiCounter    api_type                                = 1;
  uint32        num_api_call                            = 2;
  uint32        num_api_success                         = 3;
  uint32        num_api_fail                            = 4;
}

// API Stats object
message ApiStatsResponse {
  repeated ApiStatsEntry api_entries  = 1;                      // list of API statistics
}

message DropStatsEntry {
  types.DropReasons   reasons                       = 1;    // drop reasons
  uint64              drop_count                    = 2;    // drop count for multiple drop reasons
}

// Table types
enum TableType {
  TABLE_TYPE_NONE                                   = 0;
  TABLE_TYPE_INDEX                                  = 1;
  TABLE_TYPE_HASH                                   = 2;
  TABLE_TYPE_HASH_TCAM                              = 3;
  TABLE_TYPE_TCAM                                   = 4;
}

// TableStatsEntry captures table specific stats for h/w table health monitoring
message TableStatsEntry {
  TableType    table_type                           = 1;   // type of the table
  string       table_name                           = 2;   // table name
  uint32       table_size                           = 3;   // table size
  uint32       overflow_table_size                  = 4;   // overflow table size, if applicable
  uint32       entries_in_use                       = 5;   // number of entries in use
  uint32       overflow_entries_in_use              = 6;   // number of overflow entries in use, if applicable
  uint32       num_inserts                          = 7;   // number of insert operations attemtped
  uint32       num_insert_errors                    = 8;   // number of failed insert operations
  uint32       num_deletes                          = 9;   // number of delete operations attempted
  uint32       num_delete_errors                    = 10;  // number of failed delete operations
}

// TableStats is container for statistics of all tables in the data path
message TableStats {
  repeated TableStatsEntry    table_stats           = 1;
}

// BufferDropStats captures instantaneous drop counts due to buffering drops
message BufferDropStats {
  uint32 intrinsic_drop_count            = 1;     // Pkts dropped due to intrinsic drop bit being set
  uint32 discarded_count                 = 2;     // Pkts dropped due to error
  uint32 admitted_count                  = 3;     // Errored pkts admitted to buffering
  uint32 out_of_cells_drop_count         = 4;     // Pkts dropped due to cell exhaustion (first cell)
  uint32 out_of_cells_drop_count_2       = 5;     // Pkts dropped due to cell exhaustion (subsequent cell)
  uint32 out_of_credit_drop_count        = 6;     // Pkts dropped due to cell-credits exhaustion
  uint32 truncation_drop_count           = 7;     // Pkts dropped due to size bigger than the configured MTU
  uint32 port_disabled_drop_count        = 8;     // Pkts dropped due to port disable
  uint32 copy_to_cpu_tail_drop_count     = 9;     // Copy-to-cpu pkts tail dropped
  uint32 span_tail_drop_count            = 10;    // Span pkts tail dropped
  uint32 min_size_violation_drop_count   = 11;    // Pkts dropped due to lesser than min size
  uint32 enqueue_error_drop_count        = 12;    // Pkts dropped due to enqueue to reserved queues
  uint32 invalid_port_drop_count         = 13;    // Pkts dropped due to destined to invalid ports
  uint32 invalid_output_queue_drop_count = 14;    // Pkts dropped due to destined to invalid output queues
}

// BufferStats captures instantaneous counters of the buffering module
message BufferStats {
  uint32          sop_count_in  = 1;    // Count of start-of-packets in
  uint32          eop_count_in  = 2;    // Count of end-of-packets in
  uint32          sop_count_out = 3;    // Count of start-of-packets out
  uint32          eop_count_out = 4;    // Count of end-of-packets out
  BufferDropStats drop_counts   = 5;    // Drop counts 
}

// OflowFifoDropStats captures instantaneous drop counts at the overflow fifo interface
message OflowFifoDropStats {
  uint32 occupancy_drop_count                = 1;    // Pkts dropped due to fifo full
  uint32 emergency_stop_drop_count           = 2;    // Pkts dropped due to emergency condition hit due to slow oflow memory to write-buffer communication
  uint32 write_buffer_ack_fill_up_drop_count = 3;    // Pkts dropped due to write buffer's ack fifo filling up
  uint32 write_buffer_ack_full_drop_count    = 4;    // Pkts dropped due to write buffer's ack fifo full
  uint32 write_buffer_full_drop_count        = 5;    // Pkts dropped due to write buffer filling up
  uint32 control_fifo_full_drop_count        = 6;    // Pkts dropped due to control fifo full
}

// OflowFifoStats captures instantaneous counters at the overflow fifo interface
message OflowFifoStats {
  uint32             sop_count_in  = 1;    // Count of start-of-packets in
  uint32             eop_count_in  = 2;    // Count of end-of-packets in
  uint32             sop_count_out = 3;    // Count of start-of-packets out
  uint32             eop_count_out = 4;    // Count of end-of-packets out
  OflowFifoDropStats drop_counts   = 5;    // Drop counts
}

// PacketBufferPortStats is container to capture all counters exposed by the buffering
// module at the port level
message PacketBufferPortStats {
  qos.PacketBufferPort packet_buffer_port = 1;    // Port identifier
  BufferStats          buffer_stats       = 2;    // PBC block statistics
  OflowFifoStats       oflow_fifo_stats   = 3;    // Overflow fifo statistics
}

// PacketBufferStats captures all the statistics of the packet buffering module
message PacketBufferStats {
  repeated PacketBufferPortStats port_stats = 1; // list of stats, one per packet buffer port
}

// Status captures the operating status of various components in the HAL
// including "ready" status, thread health etc.
message Status {
}

// Global system object
message SystemResponse {
  types.ApiStatus    api_status      = 1;                  // API status code
  Stats              stats           = 2;                  // Statistics
  Status             status          = 3;                  // System status
}

// Stats object
message Stats {
  DropStats         drop_stats          = 1;    // Drop statistics
  TableStats        table_stats         = 2;    // Table statistics
  PacketBufferStats packet_buffer_stats = 3;    // Packet buffer block statistics
}

// Drop Stats object
message DropStats {
  repeated DropStatsEntry drop_entries  = 1;               // list of drop statistics
}
