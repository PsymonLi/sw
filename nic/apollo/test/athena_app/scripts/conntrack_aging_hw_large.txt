#Note that the test infra knows the true size of the conntrack table
#so it's fine to specify larger size parameters here. The infra will
#automatically reduce it to the actual table size as needed.

test_log_file_create /var/log/pensando/iota_conntrack_large_test.log
skip_fte_flow_prog_set TRUE
conntrack_table_clear_full 8388608
session_and_cache_clear_full 8388608

conntrack_aging_init
conntrack_aging_force_expired_ts false
conntrack_aging_accel_control false
conntrack_aging_tolerance_secs_set 0
conntrack_aging_tmo_artificial_long_set

conntrack_populate_full {tcp time_wait 8894304}
conntrack_aging_normal_tmo_set {tcp time_wait 3}
conntrack_aging_test

conntrack_populate_full {icmp unestablished 2978152}
conntrack_aging_normal_tmo_set {icmp unestablished 4}
conntrack_aging_test

#random with specified {start_idx count} and random {flowtype flowstate}
conntrack_aging_tmo_artificial_long_set
conntrack_populate_random {371 2993539}
conntrack_aging_normal_tmo_set {ICMP unestablished 3} {icmp established 3}  {others unestablished 3} {others established 3}
conntrack_aging_normal_tmo_set {udp unestablished 3} {UDP ESTABLISHED 3}
conntrack_aging_normal_tmo_set {tcp unestablished 3} {TCP syn_sent 3} {TCP SYN_RECV 3} {tcp synack_sent 3} {tcp synack_recv 3} {tcp established 3} {tcp fin_sent 40} {tcp fin_recv 3} {tcp time_wait 3} {tcp rst_close 3}
conntrack_aging_test

#random with specified {start_idx count} and specified {flowtype flowstate}
conntrack_aging_tmo_artificial_long_set
conntrack_populate_random {92573 1843847} {tcp established}
conntrack_aging_normal_tmo_set {tcp established 3}
conntrack_aging_test

#random everything
conntrack_aging_tmo_artificial_long_set
conntrack_populate_random
conntrack_aging_normal_tmo_set {ICMP unestablished 3} {icmp established 3}  {others unestablished 3} {others established 3}
conntrack_aging_normal_tmo_set {udp unestablished 3} {UDP ESTABLISHED 3}
conntrack_aging_normal_tmo_set {tcp unestablished 3} {TCP syn_sent 3} {TCP SYN_RECV 3} {tcp synack_sent 3} {tcp synack_recv 3} {tcp established 3} {tcp fin_sent 40} {tcp fin_recv 3} {tcp time_wait 3} {tcp rst_close 3}
conntrack_aging_test

#switch to accelerated aging
conntrack_aging_accel_control true
conntrack_populate_random {13 973883} {others established}
conntrack_aging_accel_tmo_set {others established 6}
conntrack_aging_test

conntrack_dump /data/iota_conntrack_large.log

conntrack_aging_metrics_show
conntrack_aging_accel_control false
conntrack_aging_tmo_factory_dflt_set
conntrack_aging_fini

skip_fte_flow_prog_set false

