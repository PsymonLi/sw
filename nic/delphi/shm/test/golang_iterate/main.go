// Code generated by protoc-gen-grpc-pensando DO NOT EDIT.
/*
 * Package restapi is a auto generated package.
 * Input file: asicerrord.proto
 */

package main

import (
	"flag"
	"fmt"

	"github.com/pensando/sw/nic/delphi/proto/goproto"
	_ "github.com/pensando/sw/nic/utils/ntranslate/asicerrord"
	"github.com/pensando/sw/venice/utils/log"
)

func main() {
	// command line flags
	var (
		numIter  = flag.Int("iter", 1000000, "number of iterations to run")
		objCount = 0
	)
	flag.Parse()

	fmt.Printf("Running %d iteration\n", *numIter)

	for i := 0; i < *numIter; i++ {
		iter, err := goproto.NewPbpbcintwrite0MetricsIterator()
		if err != nil {
			log.Errorf("failed to get metrics, error: %s", err)
			return
		}

		// for OSX tests
		if iter == nil {
			return
		}

		for iter.HasNext() {
			temp := iter.Next()
			if temp == nil {
				log.Errorf("Failed to get next obj")
			}
			objCount++
		}
		iter.Free()
		fmt.Printf("Iterated over %d objects\n", objCount)
	}

	fmt.Printf("Iterated over %d objects\n", objCount)
}
