// Code generated by protoc-gen-grpc-pensando DO NOT EDIT.

package apiclient

{{$pkgs := (getSvcManifest "../generated/apiclient/svcmanifest.json")}}
import (
    "github.com/pensando/sw/venice/utils/log"
    "github.com/pensando/sw/venice/utils/rpckit"{{range $key, $value := $pkgs}}
    {{$key}} "github.com/pensando/sw/api/generated/{{$key}}"
    {{$key}}Client "github.com/pensando/sw/api/generated/{{$key}}/grpc/client"{{end}}
)

// Services is list of all services exposed by the client ---
type Services interface {
    Close() error
    {{range $key, $value := $pkgs}}{{$pkgname := $key}}{{range $k, $v := $value.Svcs}}
    // Package is {{$key}} and len of messages is {{len $v.Messages}}{{if (ne 0 (len $v.Messages))}}
    {{$k}}() {{$pkgname}}.{{$k}}Interface{{end}}{{end}}{{end}}
}

type apiGrpcServerClient struct {
    url string
    logger log.Logger
    client *rpckit.RPCClient
    {{range $key, $value := $pkgs}}{{$pkgname := $key}}{{range $k, $v := $value.Svcs}}{{if (ne 0 (len $v.Messages))}}
    a{{$k}} {{$pkgname}}.{{$k}}Interface {{end}}{{end}}{{end}}
}

// Close closes the client
func (a *apiGrpcServerClient) Close() error {
    return a.client.Close()
}
{{range $key, $value := $pkgs}}{{$pkgname := $key}}{{range $k, $v := $value.Svcs}}
func (a *apiGrpcServerClient) {{$k}}() {{$pkgname}}.{{$k}}Interface {
    return a.a{{$k}}
}
{{end}}{{end}}
// NewGrpcAPIClient returns a gRPC client
func NewGrpcAPIClient(clientName, url string, logger log.Logger, opts ...rpckit.Option) (Services, error) {
    client, err := rpckit.NewRPCClient(clientName, url, opts...)
    if err != nil {
	logger.ErrorLog("msg", "Failed to connect to gRPC server", "URL", url, "error", err)
	return nil, err
    }
    return &apiGrpcServerClient{
        url: url,
        client: client,
        logger: logger,
        {{range $key, $value := $pkgs}}{{$pkgname := $key}}{{range $k, $v := $value.Svcs}}
        a{{$k}}: {{$pkgname}}Client.NewGrpcCrudClient{{$k}}(client.ClientConn, logger), {{end}}{{end}}
    }, nil
}

type apiRestServerClient struct {
    url string
    logger log.Logger
    {{range $key, $value := $pkgs}}{{$pkgname := $key}}{{range $k, $v := $value.Svcs}}{{if (ne 0 (len $v.Messages))}}
    a{{$k}} {{$pkgname}}.{{$k}}Interface {{end}}{{end}}{{end}}
}

// Close closes the client
func (a *apiRestServerClient) Close() error {
    return nil
}

{{range $key, $value := $pkgs}}{{$pkgname := $key}}{{range $k, $v := $value.Svcs}}
func (a *apiRestServerClient) {{$k}}() {{$pkgname}}.{{$k}}Interface {
    return a.a{{$k}}
}
{{end}}{{end}}
// NewRestAPIClient returns a REST client
func NewRestAPIClient(url string) (Services, error) {
    return &apiRestServerClient{
        url: url,
        logger: log.WithContext("module", "RestAPIClient"),
        {{range $key, $value := $pkgs}}{{$pkgname := $key}}{{range $k, $v := $value.Svcs}}
        a{{$k}}: {{$pkgname}}Client.NewRestCrudClient{{$k}}(url), {{end}}{{end}}
    }, nil
}
