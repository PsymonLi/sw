<div [style.width]="'100%'" fxLayout="column" class="newrollout">
  <div fxFlex="auto" fxLayout="row" fxLayoutAlign="center start" class="newrollout-container">
    <!-- Limiting the size of the creation form - If it is inline, we have more room to fit in the save/cancel buttons -->
    <div fxFlex="auto" fxLayout="row" [style.max-width]="isInline ? '1300px' : '1200px'"
         fxLayoutAlign="start stretch"
         class="newrollout-content">
      <div fxFlex="auto" fxLayout="column">
        <div fxFlex="auto" class="newrollout-select-button-div" fxLayout="row">
          <p-selectButton [options]="rolloutNicNodeTypes" [(ngModel)]="selectedRolloutNicNodeTypes"
                          (onChange)="onNicNodeTypeChange($event)">
          </p-selectButton>
        </div>
        <div fxFlex="auto" fxLayout="column" [formGroup]="newRollout.$formGroup">
          <div fxFlex="nogrow" fxLayout="row" class="newrollout-row" formGroupName="meta">
            <!-- meta row-->
            <div fxFlex="nogrow" class="newrollout-text">Name *:</div>
            <input fxFlex="300px" formControlName="name" appErrorTooltip
                   class="newrollout-input-common"
                   matspellcheck="false" type="text" pInputText
                   placeholder="Unique Rollout Name...">
          </div>
          <ng-container *ngTemplateOutlet="divider"></ng-container>
          <div fxFlex="noshrink" fxLayout="row" class="newrollout-row" formGroupName="spec">
            <!-- spec row-->
            <div fxFlex fxLayout="column">
              <div fxFlex="auto" fxLayout="row">
                <div fxFlex="nogrow" class="newrollout-text">Version *:</div>
                <p-dropdown class="newrollout-dropdown" fxFlex="300px" appErrorTooltip
                            formControlName="version"
                            styleClass="newrollout-font, newrollout-input-common"
                            [options]="rolloutImageOptions"
                            placeholder="version" (onChange)="onVersionChange($event)">
                  <ng-template let-version pTemplate="item">
                    <div class="ui-helper-clearfix newrollout-dropdown-div">
                      <div class="newrollout-dropdown-label">{{version.label}} -
                        {{version.model.Description}}</div>
                    </div>
                  </ng-template>
                </p-dropdown>
                <div class="newrollout-version-desc">{{versiondescription}}</div>
              </div>
              <div fxFlex></div>
              <div fxFlex="auto" fxLayout="row">
                <!-- comment out duration for now as backend does not support it - 2019-05-09
                <div fxFlex="nogrow" class="newrollout-text">Duration:</div>
                <input fxFlex="200px" formControlName="duration" appErrorTooltip class="newrollout-input-common"
                  matspellcheck="false" type="text" pInputText placeholder="Until completion"> -->
                <div fxFlex="nogrow" class="newrollout-text">Schedule *:</div>
                <p-calendar fxFlex="200px" [showTime]="true" hourFormat="24"
                            formControlName="scheduled-start-time"
                            appendTo="body" [showIcon]="true" [minDate]="minDate"
                            styleClass="newrollout-font, newrollout-input-common newrollout-calendar">
                </p-calendar>
                <p-checkbox binary="true" styleClass="newrollout-schedulenow-checkbox"
                            [value]="rolloutNowcheck" label="Schedule Now"
                            labelStyleClass="newrollout-schedulenow-text"
                            (onChange)="onRolloutNowChange($event)"></p-checkbox>
              </div>

              <div fxFlex></div>
              <div fxFlex="auto" fxLayout="row">
                <div fxFlex="nogrow" class="newrollout-text">Strategy:</div>
                <p-dropdown class="newrollout-dropdown" fxFlex="200px" appErrorTooltip
                            formControlName="strategy"
                            styleClass="newrollout-font, newrollout-input-common"
                            [options]="strategyOptions"></p-dropdown>
                <div fxFlex="nogrow" class="newrollout-text  newrollout-text-upgradetype">Upgrade
                  Type:</div>
                <p-dropdown class="newrollout-dropdown" fxFlex="200px" appErrorTooltip
                            formControlName="upgrade-type"
                            styleClass="newrollout-font, newrollout-input-common"
                            [options]="upgradetypeOptions"></p-dropdown>

              </div>

              <ng-container *ngTemplateOutlet="divider"></ng-container>


              <div fxFlex="auto" class="newrollout-maxnode-div" fxLayout="row"
                   *ngIf="isToShowNicDiv()">
                <div fxFlex="nogrow" class="newrollout-text">Max DSC In Parallel:</div>
                <input fxFlex="200px" formControlName="max-parallel" appErrorTooltip
                       class="newrollout-input-common"
                       matspellcheck="false" type="number" pInputText
                       placeholder="Max DSC to upgrade" min='1' max='10'>
              </div>
              <div fxFlex></div>
              <div fxFlex="auto" fxLayout="column" class="newrollout-nic-div"
                   *ngIf="isToShowNicDiv()">

                <div fxFlex="auto" class="newrollout-maxnic-div" fxLayout="row">
                  <div fxFlex="nogrow" class="newrollout-text">Max Allowed DSCs Failure :</div>
                  <input fxFlex="200px" formControlName="max-nic-failures-before-abort"
                         appErrorTooltip
                         class="newrollout-input-common" matspellcheck="false" type="number"
                         pInputText
                         placeholder="Max DSC Failures Allowed." min='1' max='2000'>

                </div>

                <div fxFlex></div>
                <div *ngIf="enableUpgradeByLabel()" fxFlex="auto"
                     class="newrollout-NicConstraints-div" fxLayout="row">
                  <mat-slide-toggle formControlName="smartnic-must-match-constraint" fxFlex='30px'
                                    class="newrollout-toggle newrollout-fieldtitle"
                                    (change)="onNICsConstraintsChange($event)"></mat-slide-toggle>
                  <div fxFlex="nogrow" class="newrollout-text">Upgrade DSCs by labels</div>
                </div>
                <div *ngIf="!enableUpgradeByLabel()" fxFlex="auto"
                     class="newrollout-NicConstraints-div" fxLayout="row">
                  <div fxFlex="nogrow" class="newrollout-text">Cannot upgrade DSCs by labels. No
                    DSCs with labels found.</div>
                </div>
                <div fxFlex="auto" class="newrollout-NicOrder-div" fxLayout="column"
                     *ngIf="isToShowNicOrderDiv()" formArrayName="order-constraints">
                  <app-orderedlist [dataArray]="orders"
                                   (itemClick)="toggleOrderState($event)" [template]="orderTemplate"
                                   (orderChange)="onOrderChange()">
                  </app-orderedlist>
                  <!-- #linespace -->
                  <div fxFlex="10px"></div>
                  <button (click)="addOrder()"
                          class="global-button-primary newrollout-addneworder newrollout-addneworder-clear">Add
                    Order</button>
                  <div fxFlex="10px"></div>
                </div>
              </div>
            </div>
          </div>
        </div>

      </div>
      <div *ngIf="isInline" class="newrollout-buttoncontainer" fxFlex="nogrow" fxLayout="row wrap"
           fxLayoutAlign="start start">
        <div fxFlex="nogrow">
          <span (click)="updateRollout()"
                class="global-button-primary newrollout-edit-button newrollout-save">SAVE</span>
        </div>
        <div fxFlex="nogrow">
          <span (click)="cancelRollout()"
                class="global-button-neutral newrollout-edit-button  newrollout-cancel">CANCEL</span>
        </div>
      </div>
    </div>
  </div>
</div>

<ng-template #divider>
  <div fxFlex="20px" fxLayout="row">
    <div fxFlex="30px"></div>
    <div fxFlex="auto" class="newrollout-divider"></div>
    <div fxFlex="30px"></div>
  </div>
</ng-template>

<ng-template #orderTemplate let-data="data" let-index="index" let-inEdit="inEdit">
  <div fxFlex="auto" fxLayout="column"
       fxLayoutAlign="center none" class="newrollout-order-template"
       [ngClass]="{'newrollout-hide-primeng-panel': !orders[index].inEdit}">
    <div class="newrollout-order-header" fxLayout="row"
         fxLayoutAlign="none center">
      <div fxLayout="row" fxLayoutAlign="none center">
        <b>Order</b>
      </div>
      <div *ngIf="!orders[index].inEdit" [@fastSlideInOutHorizontal]>
        : {{orders[index].orderSummary}}
      </div>
      <div fxFlex fxLayoutAlign="end center">
        <div>
          <mat-icon class="newrollout-order-buttons newrollout-order-hoverbuttons"
                    *ngIf="!orders[index].inEdit" [matTooltip]="'Edit'"
                    (click)="makeOrderEditable(index, $event)"
                    fxFlex="nogrow">edit
          </mat-icon>
          <mat-icon class="newrollout-order-buttons newrollout-order-hoverbuttons"
                    [matTooltip]="'Delete'"
                    (click)="deleteOrder(index)"
                    fxFlex="nogrow">delete
          </mat-icon>
          <mat-icon class="global-alert-warning-icon"
                    *ngIf="orders[index].incomplete"
                    [matTooltip]="'Empty Order'"
                    fxFlex="nogrow">error
          </mat-icon>
          <mat-icon class="global-alert-info-icon"
                    *ngIf="orders[index].duplicatesWith.length>0"
                    [matTooltip]="duplicateMatchTooltip(index)"
                    fxFlex="nogrow">notifications
          </mat-icon>
        </div>
        <div fxFlex="5px"></div>
        <div>
          <span class="newrollout-order-matchcount"
                [matTooltip]="'Matched Naples'">{{orders[index].matchedSmartNICs.length}}</span>
        </div>
      </div>
    </div>
    <div [@.disabled]="!repeaterAnimationEnabled">
      <!-- Not using the default slideInOut as animation has issues with drag/drop
        After dragging and dropping an element into a different spot, angular seems to be adding an element and removing it instantly. This causes an entrance animation to play when a deletion animation should be playing instead -->
      <div *ngIf="orders[index].inEdit" [@slideInOutLeave]
           (click)="$event.stopPropagation();">
        <app-repeater #repeaters [data]="orderConstraintslabelData"
                      [buildKeyPlaceholder]="buildKeyPlaceholder"
                      [buildValuePlaceholder]="buildValuePlaceholder"
                      [panelStyleClass]="'newrollout-select-panel'"
                      [formArray]="data.controls.requirements"
                      [enableMultiSelectFilter]="true"
                      [enableMultiSelectAll]="true"
                      (repeaterValues)="repeaterValueChange(index)">
        </app-repeater>
      </div>
    </div>
  </div>
</ng-template>
